<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—É–±–∞ "–í–∏—Ö—Ä—å" - –û–ù–õ–ê–ô–ù</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 95vw;
            margin: 0 auto;
            overflow-x: auto;
        }
        .tournament-table {
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            font-size: 0.85em;
            min-width: 1600px;
            border: 2px solid #2c3e50;
        }
        .tournament-table th, .tournament-table td {
            border: 2px solid #95a5a6;
            padding: 6px 8px;
            text-align: center;
            vertical-align: middle;
            min-width: 70px;
        }
        .tournament-table th {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
            border: 2px solid #34495e;
        }
        .input-cell {
            background-color: #fff;
        }
        .input-cell input {
            width: 90%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
            font-size: 0.9em;
        }
        .input-cell input:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        .result-cell {
            background-color: #e8f4fd;
            font-weight: bold;
            color: #2c3e50;
        }
        .team-header {
            background-color: #ecf0f1;
            font-weight: bold;
        }
        .participant-row {
            background-color: #f8f9fa;
        }
        .controls {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .controls button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
        }
        .controls button:hover {
            background-color: #2980b9;
        }
        .controls button.reset {
            background-color: #e74c3c;
        }
        .controls button.reset:hover {
            background-color: #c0392b;
        }
        .controls button.test {
            background-color: #2ecc71;
        }
        .controls button.test:hover {
            background-color: #27ae60;
        }
        .controls button.export {
            background-color: #9b59b6;
        }
        .controls button.export:hover {
            background-color: #8e44ad;
        }
        .controls button.edit-mode {
            background-color: #f39c12;
        }
        .controls button.edit-mode:hover {
            background-color: #d68910;
        }
        .controls button.view-mode {
            background-color: #7f8c8d;
        }
        .controls button.view-mode:hover {
            background-color: #6c7b7d;
           
            <button onclick="OnlineSync.forceSync()" style="background:#9b59b6;">
    üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
</button>
        }
        .notes {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 10px;
            padding: 10px;
            background-color: #ecf0f1;
            border-left: 4px solid #3498db;
        }
        .time-input {
            font-family: monospace;
            font-size: 0.85em;
        }
        .calculated-cell {
            background-color: #e8f6f3;
            font-weight: bold;
        }
        .personal-score {
            background-color: #d5f4e6;
            font-weight: bold;
        }
        .team-score {
            background-color: #fef9e7;
            font-weight: bold;
            font-size: 1.1em;
        }
        .error-cell {
            background-color: #fadbd8;
            color: #c0392b;
            font-weight: bold;
        }
        .formula-note {
            font-size: 0.75em;
            color: #7f8c8d;
            font-style: italic;
        }
        .participant-name {
            white-space: nowrap;
            text-align: left;
            padding-left: 10px;
            font-weight: bold;
        }
        .team-name {
            font-weight: bold;
            font-size: 1em;
        }
        .header-name {
            font-weight: bold;
        }
        .main-title {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .max-min-cell {
            background-color: #d6dbdf;
            font-weight: bold;
        }

        /* –°—Ç–∏–ª–∏ –∑–∞—â–∏—Ç—ã */
        .protected {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .warning-message {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            z-index: 10000;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –ø–∞—Ä–æ–ª—è */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .password-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 400px;
        }
        .password-form h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .password-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }
        .password-tab {
            flex: 1;
            padding: 10px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
        }
        .password-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        .password-input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
            letter-spacing: 2px;
        }
        .password-input:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }
        .password-submit {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        .password-submit:hover {
            background: #2980b9;
        }
        .password-error {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        .password-info {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 20px;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .password-hint {
            color: #95a5a6;
            font-size: 12px;
            margin-top: 15px;
            font-style: italic;
        }

        /* –°—Ç–∞—Ç—É—Å —Ä–µ–∂–∏–º–∞ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */
        .mode-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-left: auto;
        }
        .mode-status.view {
            background-color: #7f8c8d;
            color: white;
        }
        .mode-status.edit {
            background-color: #f39c12;
            color: white;
        }
        .sync-status {
            display: inline-flex;
            align-items: center;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .sync-status.online {
            background-color: #2ecc71;
            color: white;
        }
        .sync-status.offline {
            background-color: #e74c3c;
            color: white;
        }
        .sync-status.syncing {
            background-color: #3498db;
            color: white;
        }
        .sync-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .sync-indicator.online { background-color: #2ecc71; }
        .sync-indicator.offline { background-color: #e74c3c; }
        .sync-indicator.syncing {
            background-color: #3498db;
            animation: pulse 1.5s infinite;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ */
        .lock-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
        .lock-indicator.locked {
            background-color: #e74c3c;
            border-radius: 50%;
        }
        .lock-indicator.unlocked {
            background-color: #2ecc71;
            border-radius: 50%;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
        .view-message {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —à—Ç—Ä–∞—Ñ–æ–≤ */
        .penalty-cell-small input {
            width: 60px;
            font-size: 0.8em;
            padding: 2px 4px;
        }
        .penalty-header {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* –õ–æ–≥ —Å–æ–æ–±—â–µ–Ω–∏–π */
        .log-message {
            font-family: monospace;
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .log-message.success { color: #27ae60; }
        .log-message.error { color: #e74c3c; }
        .log-message.info { color: #3498db; }
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è -->
    <div id="passwordOverlay" class="password-overlay">
        <div class="password-form">
            <div class="password-tabs">
                <button class="password-tab active" onclick="switchTab('view')">–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                <button class="password-tab" onclick="switchTab('edit')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            </div>

            <div id="viewTab">
                <h2>–ü–†–û–°–ú–û–¢–† –¢–ê–ë–õ–ò–¶–´</h2>
                <p>–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –æ–Ω–ª–∞–π–Ω-–¥–∞–Ω–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä–∞.</p>
                <button id="viewSubmit" class="password-submit" onclick="enterViewMode()">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
                <div class="password-info">
                    <strong>–û–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:</strong><br>
                    ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞<br>
                    ‚Ä¢ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫<br>
                    ‚Ä¢ –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV
                </div>
                <div class="password-hint">–î–ª—è –≤–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</div>
            </div>

            <div id="editTab" style="display: none;">
                <h2>–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶–´</h2>
                <p>–î–ª—è –≤–≤–æ–¥–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</p>
                <input type="password" id="passwordInput" class="password-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞" autocomplete="off">
                <div id="passwordError" class="password-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</div>
                <button id="editSubmit" class="password-submit" onclick="enterEditMode()">–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button>
                <div class="password-info">
                    <strong>–û–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ–±–ª–∞–∫–æ<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –î–æ—Å—Ç—É–ø–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                </div>
                <div class="password-hint">–ü–∞—Ä–æ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–∞</div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="mainContent" class="container" style="display: none;">
        <div class="main-title">
            –¢–ê–ë–õ–ò–¶–ê –ë–û–õ–¨–®–û–ì–û –ó–ò–ú–ù–ï–ì–û –¢–£–†–ù–ò–†–ê –ö–õ–£–ë–ê –ü–ò–õ–û–¢–û–í –ë–ü–õ–ê "–í–ò–•–†–¨" - –û–ù–õ–ê–ô–ù
        </div>

        <div id="statusBar" style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
            <div id="syncStatus" class="sync-status offline">
                <span class="sync-indicator offline"></span>
                <span id="syncText">–û—Ñ—Ñ–ª–∞–π–Ω</span>
                <span id="syncDetail">–ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ</span>
            </div>
            <div class="log-message info" id="systemLog">[12:00:00] –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞</div>
        </div>

        <div id="viewMessage" class="view-message" style="display: none;">
            üîí <strong>–†–ï–ñ–ò–ú –ü–†–û–°–ú–û–¢–†–ê</strong> - –í—ã –º–æ–∂–µ—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        </div>

        <div class="controls">
            <button onclick="calculateAll()">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ</button>
            <button onclick="resetAll()" class="reset" id="resetButton" disabled>–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="fillTestData()" class="test" id="testButton" disabled>–ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="exportToExcel()" class="export">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
            <button onclick="forceSync()" id="syncButton">‚ü≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>

            <div id="modeStatus" class="mode-status view">
                <span class="lock-indicator locked" id="lockIndicator"></span>
                <span id="modeText">–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
            </div>

            <button onclick="switchToEditMode()" class="edit-mode" id="editModeButton">–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button>
            <button onclick="logout()" class="view-mode" id="logoutButton">–í—ã–π—Ç–∏</button>
        </div>

        <table class="tournament-table" id="tournamentTable">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
            <tr>
                <th rowspan="3" class="header-name">–ö–æ–º–∞–Ω–¥–∞</th>
                <th rowspan="3" class="header-name">–£—á–∞—Å—Ç–Ω–∏–∫</th>
                <th colspan="3" class="header-name">–õ–∏—Ç–æ—Ñ—Ñ</th>
                <th colspan="2" class="header-name">–ö–≤–∞–¥—Ä–æ—Å–∏–º</th>
                <th colspan="7" class="header-name">–†–µ–∞–ª—å–Ω–∞—è —Ç—Ä–∞—Å—Å–∞</th>
                <th rowspan="3" class="header-name">–ë–∞–ª–ª—ã –õ–ó</th>
                <th rowspan="3" class="header-name">–ë–∞–ª–ª—ã –ö–ó</th>
            </tr>

            <tr>
                <!-- –õ–∏—Ç–æ—Ñ—Ñ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–£–≥–æ–ª</th>
                <th class="header-name">–í—Ä–µ–º—è (–ú–ú:–°–°:–ú–°)</th>
                <th class="header-name">–ë–∞–ª–ª—ã</th>
                <!-- –ö–≤–∞–¥—Ä–æ—Å–∏–º –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–í—Ä–µ–º—è (–ú–ú:–°–°:–ú–°)</th>
                <th class="header-name">–ë–∞–ª–ª—ã</th>
                <!-- –¢—Ä–∞—Å—Å–∞ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–ö–æ–ª-–≤–æ –∫—Ä—É–≥–æ–≤</th>
                <th colspan="3" class="penalty-header">–®—Ç—Ä–∞—Ñ—ã (–∫–æ–ª-–≤–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π)</th>
                <th class="header-name">–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤</th>
                <th class="header-name">–ë–∞–ª–ª—ã —Ç—Ä–∞—Å—Å—ã</th>
            </tr>

            <tr class="max-min-cell">
                <!-- –õ–∏—Ç–æ—Ñ—Ñ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º—É–º–∞/–º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxAngle">0</span></td>
                <td>–ú–∏–Ω–∏–º—É–º<br><span id="minTimeLz">00:00:00</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreLz">0.00</span></td>
                <!-- –ö–≤–∞–¥—Ä–æ—Å–∏–º —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∏–Ω–∏–º—É–º<br><span id="minTimeKz">00:00:00</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreKz">0.00</span></td>
                <!-- –¢—Ä–∞—Å—Å–∞ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º—É–º–∞/–º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxLaps">0</span></td>
                <td class="penalty-header">–í–æ—Ä–æ—Ç–∞<br>(-5)</td>
                <td class="penalty-header">–ü–∞–¥–µ–Ω–∏–µ<br>(-10)</td>
                <td class="penalty-header">–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç<br>(-20)</td>
                <td>–°—É–º–º–∞<br><span id="minPenalty">0</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreTrack">0.00</span></td>
                <!-- –ü—É—Å—Ç—ã–µ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è -->
                <td></td>
                <td></td>
            </tr>

            <!-- –î–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è JavaScript -->
        </table>

        <div class="notes">
            <p><strong>–§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–æ–≤ (—Å—Ç—Ä–æ–≥–æ –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É):</strong></p>
            <ul>
                <li><strong>–ë–∞–ª–ª—ã –õ–∏—Ç–æ—Ñ—Ñ:</strong> = (–£–≥–æ–ª/–ú–ê–ö–°_–£–≥–æ–ª √ó 70) + (–ú–ò–ù_–í—Ä–µ–º—è_–õ–ó/–í—Ä–µ–º—è_–õ–ó √ó 30)</li>
                <li><strong>–ë–∞–ª–ª—ã –ö–≤–∞–¥—Ä–æ—Å–∏–º:</strong> = (–ú–ò–ù_–í—Ä–µ–º—è_–ö–ó √ó 100) / –í—Ä–µ–º—è_–ö–ó</li>
                <li><strong>–ë–∞–∑–æ–≤—ã–µ –±–∞–ª–ª—ã –¢—Ä–∞—Å—Å—ã:</strong> = (–ö—Ä—É–≥–∏/–ú–ê–ö–°_–ö—Ä—É–≥–∏ √ó 100)</li>
                <li><strong>–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤:</strong> = (–í–æ—Ä–æ—Ç–∞ √ó 5) + (–ü–∞–¥–µ–Ω–∏–µ √ó 10) + (–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç √ó 20)</li>
                <li><strong>–ë–∞–ª–ª—ã –¢—Ä–∞—Å—Å—ã:</strong> = –ë–∞–∑–æ–≤—ã–µ_–±–∞–ª–ª—ã ‚àí –°—É–º–º–∞_—à—Ç—Ä–∞—Ñ–æ–≤</li>
                <li><strong>–ë–∞–ª–ª—ã –õ–ó (–ª–∏—á–Ω—ã–π –∑–∞—á–µ—Ç):</strong> = –ë–∞–ª–ª—ã_–õ–∏—Ç–æ—Ñ—Ñ + –ë–∞–ª–ª—ã_–ö–≤–∞–¥—Ä–æ—Å–∏–º + –ë–∞–ª–ª—ã_–¢—Ä–∞—Å—Å—ã</li>
                <li><strong>–ë–∞–ª–ª—ã –ö–ó (–∫–æ–º–∞–Ω–¥–Ω—ã–π –∑–∞—á–µ—Ç):</strong> = –°—É–º–º–∞ –ë–∞–ª–ª–æ–≤_–õ–ó –æ–±–æ–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã (–æ–¥–Ω–∞ —è—á–µ–π–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É)</li>
                <li><strong>–û–ñ–ò–î–ê–ù–ò–ï:</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –¥–µ–ª–µ–Ω–∏–∏ –Ω–∞ –Ω–æ–ª—å</li>
            </ul>
            <p><strong>–®—Ç—Ä–∞—Ñ—ã –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É:</strong> –í—Ä–µ–∑–∞–Ω–∏–µ –≤ –≤–æ—Ä–æ—Ç–∞ (-5), –ü–∞–¥–µ–Ω–∏–µ (-10), –ü–∞–¥–µ–Ω–∏–µ —Å –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–æ–º (-20)</p>
            <p><strong>–û–Ω–ª–∞–π–Ω-—Ñ—É–Ω–∫—Ü–∏–∏:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥, –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ–±–ª–∞–∫–æ.</p>
        </div>
    </div>

    <div id="warningMessage" class="warning-message"></div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ ==========
        // –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –î–ê–ù–ù–´–ï –ù–ê –°–í–û–ò!

        // 1. –í–ê–® –ù–û–í–´–ô GitHub Personal Access Token (–ø–æ—Å–ª–µ –æ—Ç–∑—ã–≤–∞ —Å—Ç–∞—Ä–æ–≥–æ)
        const GITHUB_TOKEN = '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';

        // 2. –í–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ '–≤–∞—à–ª–æ–≥–∏–Ω/turnirvihr')
        const REPO = 'azm197414/turnirvihr'; // –ü—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

        // 3. –ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
        const DATA_FILE = 'turnir_data.json';

        // 4. –ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å)
        const EDIT_PASSWORD = "–í–∏—Ö—Ä—å2024";

        // 5. URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (–ø—É–±–ª–∏—á–Ω—ã–π) –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (—á–µ—Ä–µ–∑ API) –¥–∞–Ω–Ω—ã—Ö
        const DATA_URL = `https://raw.githubusercontent.com/${REPO}/main/${DATA_FILE}`;
        const SAVE_URL = `https://api.github.com/repos/${REPO}/contents/${DATA_FILE}`;

        // ========== –°–ò–°–¢–ï–ú–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        const STORAGE_KEYS = {
            LOCAL_DATA: '—Ç—É—Ä–Ω–∏—Ä_–¥–∞–Ω–Ω—ã–µ',
            MODE: '—Ç—É—Ä–Ω–∏—Ä_—Ä–µ–∂–∏–º',
            EDIT_SESSION: '—Ç—É—Ä–Ω–∏—Ä_—Ä–µ–¥–∞–∫—Ç–æ—Ä_—Å–µ—Å—Å–∏—è'
        };

        let currentMode = 'view';
        let isOnline = false;
        let dataSHA = null; // SHA —Ö–µ—à —Ñ–∞–π–ª–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        let syncInterval;
        const participants = [
            { team: "–ò–Ω—Ç–µ–Ω—Å–∏–≤", name: "–ö—Å–µ–Ω–∏—è –õ.", id: 1, teamIndex: 0 },
            { team: "–ò–Ω—Ç–µ–Ω—Å–∏–≤", name: "–°–≤—è—Ç–æ—Å–ª–∞–≤ –ï.", id: 2, teamIndex: 0 },
            { team: "–ü—Ä–æ—Ä—ã–≤", name: "–ù–∏–∫–∏—Ç–∞ –£.", id: 3, teamIndex: 1 },
            { team: "–ü—Ä–æ—Ä—ã–≤", name: "–í–∞—Ä—è –ê.", id: 4, teamIndex: 1 },
            { team: "–ê–ª—å—Ñ–∞", name: "–î–º–∏—Ç—Ä–∏–π –í.", id: 5, teamIndex: 2 },
            { team: "–ê–ª—å—Ñ–∞", name: "–ò–≤–∞–Ω –§.", id: 6, teamIndex: 2 },
            { team: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", name: "–°–∞–≤–µ–ª–∏–π –°.", id: 7, teamIndex: 3 },
            { team: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", name: "–ë–æ–≥–¥–∞–Ω –ï.", id: 8, teamIndex: 3 },
            { team: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è", name: "–ê—Ä—Ç–µ–º –ü.", id: 9, teamIndex: 4 },
            { team: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è", name: "–î–∞–Ω–∏–ª–∞ –õ.", id: 10, teamIndex: 4 }
        ];

        // ========== –°–ò–°–¢–ï–ú–ê –î–û–°–¢–£–ü–ê –ò –ò–ù–¢–ï–†–§–ï–ô–° ==========
        function switchTab(tab) {
            document.querySelectorAll('.password-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('viewTab').style.display = 'none';
            document.getElementById('editTab').style.display = 'none';

            if (tab === 'view') {
                document.querySelector('.password-tab[onclick="switchTab(\'view\')"]').classList.add('active');
                document.getElementById('viewTab').style.display = 'block';
            } else {
                document.querySelector('.password-tab[onclick="switchTab(\'edit\')"]').classList.add('active');
                document.getElementById('editTab').style.display = 'block';
                document.getElementById('passwordInput').focus();
            }
        }

        function enterViewMode() {
            currentMode = 'view';
            showMainContent();
        }

        function enterEditMode() {
            const passwordInput = document.getElementById('passwordInput');
            const passwordError = document.getElementById('passwordError');
            const enteredPassword = passwordInput.value.trim();

            if (enteredPassword === EDIT_PASSWORD) {
                passwordError.style.display = 'none';
                passwordInput.value = '';
                currentMode = 'edit';
                localStorage.setItem(STORAGE_KEYS.EDIT_SESSION, 'active');
                showMainContent();
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
                if (navigator.vibrate) navigator.vibrate(200);
            }
        }

        function showMainContent() {
            document.getElementById('passwordOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';

            localStorage.setItem(STORAGE_KEYS.MODE, currentMode);
            setupInterfaceForMode();
            initTable();
            startAutoSync();
        }

        function setupInterfaceForMode() {
          
            const viewMessage = document.getElementById('viewMessage');
            const resetButton = document.getElementById('resetButton');
            const testButton = document.getElementById('testButton');
            const editModeButton = document.getElementById('editModeButton');
            const modeStatus = document.getElementById('modeStatus');
            const modeText = document.getElementById('modeText');
            const lockIndicator = document.getElementById('lockIndicator');
            
            if (currentMode === 'edit' && window.OnlineSync) {
                window.OnlineSync.startAutoSync();
           }
            if (currentMode === 'view') {
                viewMessage.style.display = 'block';
                resetButton.disabled = true;
                testButton.disabled = true;
                editModeButton.style.display = 'inline-block';
                modeStatus.className = 'mode-status view';
                modeText.textContent = '–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞';
                lockIndicator.className = 'lock-indicator locked';
                disableInputFields();
            } else {
                viewMessage.style.display = 'none';
                resetButton.disabled = false;
                testButton.disabled = false;
                editModeButton.style.display = 'none';
                modeStatus.className = 'mode-status edit';
                modeText.textContent = '–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
                lockIndicator.className = 'lock-indicator unlocked';
                enableInputFields();
            }
        }

        function disableInputFields() {
            const inputs = document.querySelectorAll('.input-cell input');
            inputs.forEach(input => {
                input.disabled = true;
                input.title = '–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.';
            });
        }

        function enableInputFields() {
            const inputs = document.querySelectorAll('.input-cell input');
            inputs.forEach(input => {
                input.disabled = false;
                input.title = '';
            });
        }

        function switchToEditMode() {
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('passwordOverlay').style.display = 'flex';
            switchTab('edit');
            document.getElementById('passwordInput').focus();
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.removeItem(STORAGE_KEYS.EDIT_SESSION);
                stopAutoSync();
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('passwordOverlay').style.display = 'flex';
                switchTab('view');
            }
        }

        function checkSavedSession() {
            const editSession = localStorage.getItem(STORAGE_KEYS.EDIT_SESSION);
            const savedMode = localStorage.getItem(STORAGE_KEYS.MODE);

            if (editSession === 'active') {
                currentMode = 'edit';
                return true;
            } else if (savedMode === 'view' || savedMode === 'edit') {
                currentMode = savedMode;
                if (currentMode === 'edit') {
                    currentMode = 'view'; // –ë–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤ –ø—Ä–æ—Å–º–æ—Ç—Ä
                }
                return true;
            }
            return false;
        }

        // –ê–≤—Ç–æ–≤—ã—Ö–æ–¥ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ 4 —á–∞—Å–∞
        setTimeout(() => {
            if (localStorage.getItem(STORAGE_KEYS.EDIT_SESSION) === 'active') {
                localStorage.removeItem(STORAGE_KEYS.EDIT_SESSION);
                localStorage.setItem(STORAGE_KEYS.MODE, 'view');

                if (currentMode === 'edit') {
                    currentMode = 'view';
                    setupInterfaceForMode();
                    showWarning('–°–µ—Å—Å–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∏—Å—Ç–µ–∫–ª–∞. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω –≤ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.');
                    logMessage('–°–µ—Å—Å–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∏—Å—Ç–µ–∫–ª–∞', 'info');
                }
            }
        }, 4 * 60 * 60 * 1000);

        // ========== –û–ù–õ–ê–ô–ù-–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø ==========
        function setSyncStatus(status, detail = '') {
            const syncElement = document.getElementById('syncStatus');
            const syncIndicator = syncElement.querySelector('.sync-indicator');
            const syncText = document.getElementById('syncText');
            const syncDetail = document.getElementById('syncDetail');
            const syncButton = document.getElementById('syncButton');

            syncElement.className = `sync-status ${status}`;
            syncIndicator.className = `sync-indicator ${status}`;

            if (status === 'online') {
                syncText.textContent = '–û–Ω–ª–∞–π–Ω';
                syncDetail.textContent = detail || '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
                syncButton.textContent = '‚ü≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å';
                syncButton.disabled = false;
                isOnline = true;
            } else if (status === 'offline') {
                syncText.textContent = '–û—Ñ—Ñ–ª–∞–π–Ω';
                syncDetail.textContent = detail || '–ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ';
                syncButton.textContent = '‚ü≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å';
                syncButton.disabled = false;
                isOnline = false;
            } else if (status === 'syncing') {
                syncText.textContent = '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
                syncDetail.textContent = detail || '–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';
                syncButton.textContent = '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...';
                syncButton.disabled = true;
            }
        }

        async function forceSync() {
            if (currentMode === 'edit') {
                await saveOnlineData();
            } else {
                await loadOnlineData();
            }
        }

        function startAutoSync() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –µ—Å–ª–∏ –±—ã–ª
            if (syncInterval) clearInterval(syncInterval);

            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
            syncInterval = setInterval(async () => {
                if (currentMode === 'edit') {
                    // –í —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    await saveOnlineData();
                } else {
                    // –í —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ - –∑–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    await loadOnlineData();
                }
            }, 60000); // 60 —Å–µ–∫—É–Ω–¥

            logMessage('–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞ (60 —Å–µ–∫)', 'info');
        }

        function stopAutoSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
                logMessage('–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞', 'info');
            }
        }

        async function saveOnlineData() {
            if (currentMode !== 'edit') {
                logMessage('–¢–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–Ω–ª–∞–π–Ω', 'error');
                return false;
            }

            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            const data = collectAllData();

            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
            localStorage.setItem(STORAGE_KEYS.LOCAL_DATA, JSON.stringify(data));

            setSyncStatus('syncing', '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–æ...');
            logMessage('–ù–∞—á–∏–Ω–∞—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-–¥–∞–Ω–Ω—ã—Ö...', 'info');

            try {
                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è GitHub API
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
                const body = {
                    message: `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–∞ –æ—Ç ${new Date().toLocaleString('ru-RU')}`,
                    content: content
                };

                // –ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å SHA –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                if (dataSHA) {
                    body.sha = dataSHA;
                }

                const response = await fetch(SAVE_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }

                const result = await response.json();
                dataSHA = result.content.sha; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–π SHA

                setSyncStatus('online', `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}`);
                logMessage(`–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–æ!`, 'success');
                return true;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                setSyncStatus('offline', `–û—à–∏–±–∫–∞: ${error.message.substring(0, 30)}...`);
                logMessage(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
                showWarning(`–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ${error.message}`);
                return false;
            }
        }

        async function loadOnlineData() {
            setSyncStatus('syncing', '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
            logMessage('–ó–∞–ø—Ä–∞—à–∏–≤–∞—é –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞...', 'info');

            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å GitHub (—Å—ã—Ä–æ–π —Ñ–∞–π–ª)
                const response = await fetch(DATA_URL + '?t=' + Date.now()); // –î–æ–±–∞–≤–ª—è–µ–º timestamp –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–µ—à–∞

                if (!response.ok) {
                    if (response.status === 404) {
                        logMessage('–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –Ω–∞–π–¥–µ–Ω. –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.', 'info');
                        setSyncStatus('offline', '–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return null;
                    }
                    throw new Error(`HTTP ${response.status}`);
                }

                // –ü–æ–ª—É—á–∞–µ–º SHA —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ GitHub API
                const apiResponse = await fetch(SAVE_URL, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (apiResponse.ok) {
                    const fileInfo = await apiResponse.json();
                    dataSHA = fileInfo.sha;
                }

                const data = await response.json();

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ —Ç–∞–±–ª–∏—Ü–µ
                applyDataToTable(data);
                localStorage.setItem(STORAGE_KEYS.LOCAL_DATA, JSON.stringify(data));

                setSyncStatus('online', `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}`);
                logMessage(`–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞!`, 'success');

                return data;

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                setSyncStatus('offline', '–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                logMessage(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–Ω–ª–∞–π–Ω-–¥–∞–Ω–Ω—ã–µ. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ.`, 'error');

                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
                const localData = localStorage.getItem(STORAGE_KEYS.LOCAL_DATA);
                if (localData) {
                    try {
                        applyDataToTable(JSON.parse(localData));
                        logMessage('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞', 'info');
                    } catch (e) {
                        logMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', 'error');
                    }
                }

                return null;
            }
        }

        function collectAllData() {
            const data = {};
            for (let i = 0; i < participants.length; i++) {
                data[`participant_${i}`] = {
                    angle: document.getElementById(`angle_${i}`).value,
                    timeLz: document.getElementById(`time_lz_${i}`).value,
                    timeKz: document.getElementById(`time_kz_${i}`).value,
                    laps: document.getElementById(`laps_${i}`).value,
                    penalty_gates: document.getElementById(`penalty_gates_${i}`).value,
                    penalty_fall: document.getElementById(`penalty_fall_${i}`).value,
                    penalty_flip: document.getElementById(`penalty_flip_${i}`).value
                };
            }
            return data;
        }

        function applyDataToTable(data) {
            if (!data) return;

            for (let i = 0; i < participants.length; i++) {
                if (data[`participant_${i}`]) {
                    const p = data[`participant_${i}`];
                    const angleInput = document.getElementById(`angle_${i}`);
                    const timeLzInput = document.getElementById(`time_lz_${i}`);
                    const timeKzInput = document.getElementById(`time_kz_${i}`);

                    if (angleInput) angleInput.value = p.angle || 0;
                    if (timeLzInput) timeLzInput.value = p.timeLz || '00:00:00';
                    if (timeKzInput) timeKzInput.value = p.timeKz || '00:00:00';

                    document.getElementById(`laps_${i}`).value = p.laps || 0;
                    document.getElementById(`penalty_gates_${i}`).value = p.penalty_gates || 0;
                    document.getElementById(`penalty_fall_${i}`).value = p.penalty_fall || 0;
                    document.getElementById(`penalty_flip_${i}`).value = p.penalty_flip || 0;
                }
            }
            calculateAll();
        }

        function logMessage(message, type = 'info') {
            const logElement = document.getElementById('systemLog');
            const timestamp = new Date().toLocaleTimeString('ru-RU', {hour12: false});
            logElement.innerHTML = `[${timestamp}] ${message}`;
            logElement.className = `log-message ${type}`;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            console.log(`[–¢—É—Ä–Ω–∏—Ä] ${message}`);
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    enterEditMode();
                }
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
            if (checkSavedSession()) {
                showMainContent();
            } else {
                document.getElementById('passwordOverlay').style.display = 'flex';
                switchTab('view');
            }

            // –ü—ã—Ç–∞–µ–º—Å—è —Å—Ä–∞–∑—É –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–Ω–ª–∞–π–Ω-–¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                if (document.getElementById('mainContent').style.display !== 'none') {
                    loadOnlineData();
                }
            }, 1000);

            initProtection();
        });

        // ========== –§–£–ù–ö–¶–ò–ò –¢–ê–ë–õ–ò–¶–´ (–û–°–¢–ê–í–õ–Ø–ï–ú –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô) ==========
        // [–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç initTable() –¥–æ exportToExcel() –æ—Å—Ç–∞—é—Ç—Å—è –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô]
        // –ò–∑ –≤–∞—à–µ–≥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞, –≤–∫–ª—é—á–∞—è createTable, calculateAll, saveToLocalStorage –∏ —Ç.–¥.
        // –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞ –∑–¥–µ—Å—å –Ω–µ –¥—É–±–ª–∏—Ä—É–µ–º, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å –≤ –≤–∞—à–µ–º —Ñ–∞–π–ª–µ

        // ========== –ù–ê–ß–ê–õ–û –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø –ò–ó –í–ê–®–ï–ì–û –ò–°–•–û–î–ù–û–ì–û –ö–û–î–ê ==========
        function initTable() {
            createTable();
            loadFromLocalStorage();
            protectElements();

            if (currentMode === 'view') {
                disableInputFields();
            } else {
                enableInputFields();
            }
            calculateAll();
        }

        function createTable() {
            const table = document.getElementById('tournamentTable');

            while (table.rows.length > 3) {
                table.deleteRow(3);
            }

            participants.forEach((participant, index) => {
                const row = table.insertRow();
                const isFirstInTeam = index === 0 || participants[index-1].team !== participant.team;

                if (isFirstInTeam) {
                    row.className = 'team-header';
                } else {
                    row.className = 'participant-row';
                }

                if (isFirstInTeam) {
                    row.innerHTML = `
                        <td rowspan="2" class="team-name">"${participant.team}"</td>
                        <td class="participant-name">${participant.name}</td>
                        <td class="input-cell"><input type="number" id="angle_${index}" min="0" max="90" value="0" step="1" placeholder="0-90¬∞"></td>
                        <td class="input-cell"><input type="text" id="time_lz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_lz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="text" id="time_kz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_kz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="number" id="laps_${index}" min="0" value="0" placeholder="0+"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_gates_${index}" min="0" value="0" placeholder="0" title="–í—Ä–µ–∑–∞–Ω–∏–µ –≤ –≤–æ—Ä–æ—Ç–∞ (-5 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_fall_${index}" min="0" value="0" placeholder="0" title="–ü–∞–¥–µ–Ω–∏–µ (-10 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_flip_${index}" min="0" value="0" placeholder="0" title="–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç (-20 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="calculated-cell" id="total_penalty_${index}">0</td>
                        <td class="result-cell" id="score_track_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="personal-score" id="personal_score_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td rowspan="2" class="team-score" id="team_score_${participant.teamIndex}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td class="participant-name">${participant.name}</td>
                        <td class="input-cell"><input type="number" id="angle_${index}" min="0" max="90" value="0" step="1" placeholder="0-90¬∞"></td>
                        <td class="input-cell"><input type="text" id="time_lz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_lz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="text" id="time_kz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_kz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="number" id="laps_${index}" min="0" value="0" placeholder="0+"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_gates_${index}" min="0" value="0" placeholder="0" title="–í—Ä–µ–∑–∞–Ω–∏–µ –≤ –≤–æ—Ä–æ—Ç–∞ (-5 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_fall_${index}" min="0" value="0" placeholder="0" title="–ü–∞–¥–µ–Ω–∏–µ (-10 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_flip_${index}" min="0" value="0" placeholder="0" title="–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç (-20 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="calculated-cell" id="total_penalty_${index}">0</td>
                        <td class="result-cell" id="score_track_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="personal-score" id="personal_score_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                    `;
                }
            });

            addInputEventListeners();
        }

        function addInputEventListeners() {
            for (let i = 0; i < participants.length; i++) {
                const inputs = [
                    `angle_${i}`, `time_lz_${i}`, `time_kz_${i}`, `laps_${i}`,
                    `penalty_gates_${i}`, `penalty_fall_${i}`, `penalty_flip_${i}`
                ];

                inputs.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', () => {
                            if (currentMode === 'edit') {
                                calculateAll();
                                saveToLocalStorage();
                                // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                debouncedOnlineSave();
                            }
                        });

                        if (id.startsWith('time_')) {
                            input.addEventListener('blur', function() {
                                if (currentMode === 'edit') {
                                    formatTimeInput(this);
                                    calculateAll();
                                    saveToLocalStorage();
                                    debouncedOnlineSave();
                                }
                            });
                        }
                    }
                });
            }
        }

        // –ó–∞–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω
        let saveTimeout;
        function debouncedOnlineSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                if (currentMode === 'edit') {
                    saveOnlineData();
                }
            }, 10000); // 10 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        }

        function protectElements() {
            const elements = document.querySelectorAll(
                '.result-cell, .personal-score, .team-score, .calculated-cell, .max-min-cell, .header-name'
            );
            elements.forEach(el => {
                el.classList.add('protected');
            });
        }

        function formatTimeInput(input) {
            let value = input.value.trim();
            if (!value) {
                input.value = '00:00:00';
                return;
            }
            value = value.replace(/[^\d]/g, '');
            while (value.length < 6) value = '0' + value;
            value = value.substring(0, 6);
            const minutes = value.substring(0, 2);
            const seconds = value.substring(2, 4);
            const milliseconds = value.substring(4, 6);
            input.value = `${minutes}:${seconds}:${milliseconds}`;
        }

        function timeToSeconds(timeStr) {
            if (!timeStr || timeStr === '00:00:00') return 0;
            const parts = timeStr.split(':');
            if (parts.length !== 3) return 0;
            const minutes = parseInt(parts[0]) || 0;
            const seconds = parseInt(parts[1]) || 0;
            const milliseconds = parseInt(parts[2]) || 0;
            if (isNaN(minutes) || isNaN(seconds) || isNaN(milliseconds)) return 0;
            return minutes * 60 + seconds + (milliseconds / 100);
        }

        function secondsToTime(seconds) {
            if (seconds <= 0) return '00:00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            const ms = Math.round((seconds - Math.floor(seconds)) * 100);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}:${ms.toString().padStart(2, '0')}`;
        }

        function calculateAll() {
            const participantsData = [];

            for (let i = 0; i < participants.length; i++) {
                const gates = parseInt(document.getElementById(`penalty_gates_${i}`).value) || 0;
                const falls = parseInt(document.getElementById(`penalty_fall_${i}`).value) || 0;
                const flips = parseInt(document.getElementById(`penalty_flip_${i}`).value) || 0;
                const totalPenalty = (gates * 5) + (falls * 10) + (flips * 20);

                participantsData.push({
                    index: i,
                    angle: parseFloat(document.getElementById(`angle_${i}`).value) || 0,
                    timeLz: timeToSeconds(document.getElementById(`time_lz_${i}`).value),
                    timeKz: timeToSeconds(document.getElementById(`time_kz_${i}`).value),
                    laps: parseFloat(document.getElementById(`laps_${i}`).value) || 0,
                    gates: gates,
                    falls: falls,
                    flips: flips,
                    totalPenalty: totalPenalty,
                    teamIndex: participants[i].teamIndex
                });
            }

            const maxAngle = Math.max(...participantsData.filter(p => p.angle > 0).map(p => p.angle));
            const minTimeLz = Math.min(...participantsData.filter(p => p.timeLz > 0).map(p => p.timeLz));
            const minTimeKz = Math.min(...participantsData.filter(p => p.timeKz > 0).map(p => p.timeKz));
            const maxLaps = Math.max(...participantsData.filter(p => p.laps > 0).map(p => p.laps));
            const minTotalPenalty = Math.min(...participantsData.filter(p => p.totalPenalty > 0).map(p => p.totalPenalty));

            document.getElementById('maxAngle').textContent = maxAngle > 0 ? maxAngle : '0';
            document.getElementById('minTimeLz').textContent = minTimeLz > 0 ? secondsToTime(minTimeLz) : '00:00:00';
            document.getElementById('minTimeKz').textContent = minTimeKz > 0 ? secondsToTime(minTimeKz) : '00:00:00';
            document.getElementById('maxLaps').textContent = maxLaps > 0 ? maxLaps : '0';
            document.getElementById('minPenalty').textContent = minTotalPenalty > 0 ? minTotalPenalty : '0';

            let maxScoreLz = 0, maxScoreKz = 0, maxScoreTrack = 0;

            participantsData.forEach(data => {
                const i = data.index;

                document.getElementById(`total_penalty_${i}`).textContent = data.totalPenalty;

                let scoreLz = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (maxAngle > 0 && data.angle > 0 && minTimeLz > 0 && data.timeLz > 0) {
                    const calculated = ((data.angle / maxAngle) * 70) + ((minTimeLz / data.timeLz) * 30);
                    scoreLz = calculated.toFixed(2);
                    maxScoreLz = Math.max(maxScoreLz, calculated);
                }

                let scoreKz = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (minTimeKz > 0 && data.timeKz > 0) {
                    const calculated = (minTimeKz * 100) / data.timeKz;
                    scoreKz = calculated.toFixed(2);
                    maxScoreKz = Math.max(maxScoreKz, calculated);
                }

                let scoreTrack = "–û–ñ–ò–î–ê–ù–ò–ï";
                let baseScoreTrack = 0;
                if (maxLaps > 0 && data.laps > 0) {
                    baseScoreTrack = (data.laps / maxLaps) * 100;
                    const calculated = baseScoreTrack - data.totalPenalty;
                    scoreTrack = calculated > 0 ? calculated.toFixed(2) : "0.00";
                    maxScoreTrack = Math.max(maxScoreTrack, calculated > 0 ? calculated : 0);
                }

                let personalScore = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (scoreLz !== "–û–ñ–ò–î–ê–ù–ò–ï" && scoreKz !== "–û–ñ–ò–î–ê–ù–ò–ï" && scoreTrack !== "–û–ñ–ò–î–ê–ù–ò–ï") {
                    personalScore = (parseFloat(scoreLz) + parseFloat(scoreKz) + parseFloat(scoreTrack)).toFixed(2);
                }

                data.personalScore = personalScore === "–û–ñ–ò–î–ê–ù–ò–ï" ? 0 : parseFloat(personalScore);

                document.getElementById(`score_lz_${i}`).textContent = scoreLz;
                document.getElementById(`score_lz_${i}`).className = scoreLz === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";
                document.getElementById(`score_kz_${i}`).textContent = scoreKz;
                document.getElementById(`score_kz_${i}`).className = scoreKz === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";
                document.getElementById(`score_track_${i}`).textContent = scoreTrack;
                document.getElementById(`score_track_${i}`).className = scoreTrack === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";
                document.getElementById(`personal_score_${i}`).textContent = personalScore;
                document.getElementById(`personal_score_${i}`).className = personalScore === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "personal-score";
            });

            document.getElementById('maxScoreLz').textContent = maxScoreLz.toFixed(2);
            document.getElementById('maxScoreKz').textContent = maxScoreKz.toFixed(2);
            document.getElementById('maxScoreTrack').textContent = maxScoreTrack.toFixed(2);

            const teamScores = {};
            participantsData.forEach(data => {
                if (!teamScores[data.teamIndex]) teamScores[data.teamIndex] = 0;
                teamScores[data.teamIndex] += data.personalScore;
            });

            for (const [teamIndex, teamScore] of Object.entries(teamScores)) {
                document.getElementById(`team_score_${teamIndex}`).textContent = teamScore.toFixed(2);
                document.getElementById(`team_score_${teamIndex}`).className = "team-score";
            }

            for (let i = 0; i < 5; i++) {
                if (!teamScores[i]) {
                    document.getElementById(`team_score_${i}`).textContent = "–û–ñ–ò–î–ê–ù–ò–ï";
                    document.getElementById(`team_score_${i}`).className = "error-cell";
                }
            }
        }

        function saveToLocalStorage() {
            const data = collectAllData();
            localStorage.setItem(STORAGE_KEYS.LOCAL_DATA, JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem(STORAGE_KEYS.LOCAL_DATA);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    applyDataToTable(data);
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', e);
                }
            }
        }

        function resetAll() {
            if (currentMode !== 'edit') {
                showWarning('–¢–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.');
                return;
            }

            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –í—Å–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                for (let i = 0; i < participants.length; i++) {
                    document.getElementById(`angle_${i}`).value = 0;
                    document.getElementById(`time_lz_${i}`).value = '00:00:00';
                    document.getElementById(`time_kz_${i}`).value = '00:00:00';
                    document.getElementById(`laps_${i}`).value = 0;
                    document.getElementById(`penalty_gates_${i}`).value = 0;
                    document.getElementById(`penalty_fall_${i}`).value = 0;
                    document.getElementById(`penalty_flip_${i}`).value = 0;

                    ['score_lz_', 'score_kz_', 'score_track_', 'personal_score_'].forEach(prefix => {
                        document.getElementById(`${prefix}${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                        document.getElementById(`${prefix}${i}`).className = 'error-cell';
                    });

                    document.getElementById(`total_penalty_${i}`).textContent = '0';
                }

                for (let i = 0; i < 5; i++) {
                    document.getElementById(`team_score_${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                    document.getElementById(`team_score_${i}`).className = 'error-cell';
                }

                ['maxAngle', 'maxScoreLz', 'maxScoreKz', 'maxLaps', 'maxScoreTrack'].forEach(id => {
                    document.getElementById(id).textContent = id === 'maxAngle' || id === 'maxLaps' ? '0' : '0.00';
                });

                ['minTimeLz', 'minTimeKz'].forEach(id => {
                    document.getElementById(id).textContent = '00:00:00';
                });

                document.getElementById('minPenalty').textContent = '0';

                localStorage.removeItem(STORAGE_KEYS.LOCAL_DATA);
                // –¢–∞–∫–∂–µ —É–¥–∞–ª–∏–º –æ–Ω–ª–∞–π–Ω-—Ñ–∞–π–ª?
                if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–∞–∫–∂–µ –æ–Ω–ª–∞–π–Ω-—Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏?')) {
                    deleteOnlineData();
                }

                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã!');
            }
        }

        async function deleteOnlineData() {
            if (!dataSHA) {
                alert('–§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');
                return;
            }

            try {
                const response = await fetch(SAVE_URL, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: '–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–∞',
                        sha: dataSHA
                    })
                });

                if (response.ok) {
                    dataSHA = null;
                    logMessage('–û–Ω–ª–∞–π–Ω-—Ñ–∞–π–ª –¥–∞–Ω–Ω—ã—Ö —É–¥–∞–ª–µ–Ω', 'success');
                }
            } catch (error) {
                logMessage(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-—Ñ–∞–π–ª–∞: ${error.message}`, 'error');
            }
        }

        function fillTestData() {
            if (currentMode !== 'edit') {
                showWarning('–¢–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.');
                return;
            }

            const testData = [
                { angle: 51, timeLz: '00:45:00', timeKz: '01:15:30', laps: 8, gates: 1, falls: 0, flips: 0 },
                { angle: 63, timeLz: '00:53:00', timeKz: '01:20:45', laps: 10, gates: 2, falls: 1, flips: 0 },
                { angle: 45, timeLz: '00:48:30', timeKz: '01:30:45', laps: 12, gates: 0, falls: 1, flips: 0 },
                { angle: 38, timeLz: '00:52:15', timeKz: '01:35:20', laps: 9, gates: 1, falls: 0, flips: 1 },
                { angle: 55, timeLz: '00:42:10', timeKz: '01:25:30', laps: 11, gates: 3, falls: 0, flips: 0 },
                { angle: 42, timeLz: '00:55:40', timeKz: '01:40:15', laps: 7, gates: 0, falls: 2, flips: 0 },
                { angle: 60, timeLz: '00:46:20', timeKz: '01:18:50', laps: 13, gates: 1, falls: 1, flips: 0 },
                { angle: 35, timeLz: '00:57:10', timeKz: '01:45:30', laps: 6, gates: 2, falls: 0, flips: 1 },
                { angle: 48, timeLz: '00:49:45', timeKz: '01:28:15', laps: 10, gates: 0, falls: 0, flips: 0 },
                { angle: 40, timeLz: '00:54:20', timeKz: '01:38:40', laps: 8, gates: 1, falls: 1, flips: 0 }
            ];

            for (let i = 0; i < participants.length; i++) {
                const data = testData[i];
                document.getElementById(`angle_${i}`).value = data.angle;
                document.getElementById(`time_lz_${i}`).value = data.timeLz;
                document.getElementById(`time_kz_${i}`).value = data.timeKz;
                document.getElementById(`laps_${i}`).value = data.laps;
                document.getElementById(`penalty_gates_${i}`).value = data.gates;
                document.getElementById(`penalty_fall_${i}`).value = data.falls;
                document.getElementById(`penalty_flip_${i}`).value = data.flips;
            }

            calculateAll();
            saveToLocalStorage();
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–Ω–ª–∞–π–Ω
            setTimeout(() => saveOnlineData(), 1000);
            alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –ß–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ–±–ª–∞–∫–æ.');
        }

        function exportToExcel() {
            let csvContent = "data:text/csv;charset=utf-8,";
            const headers = [
                "–ö–æ–º–∞–Ω–¥–∞", "–£—á–∞—Å—Ç–Ω–∏–∫", "–£–≥–æ–ª (–õ–∏—Ç–æ—Ñ—Ñ)", "–í—Ä–µ–º—è –õ–ó", "–ë–∞–ª–ª—ã –õ–ó",
                "–í—Ä–µ–º—è –ö–ó", "–ë–∞–ª–ª—ã –ö–ó", "–ö—Ä—É–≥–∏", "–®—Ç—Ä–∞—Ñ—ã: –í–æ—Ä–æ—Ç–∞", "–®—Ç—Ä–∞—Ñ—ã: –ü–∞–¥–µ–Ω–∏–µ", "–®—Ç—Ä–∞—Ñ—ã: –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç",
                "–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤", "–ë–∞–ª–ª—ã –¢—Ä–∞—Å—Å—ã", "–ë–∞–ª–ª—ã –õ–ó", "–ë–∞–ª–ª—ã –ö–ó"
            ];

            csvContent += headers.join(";") + "\n";

            for (let i = 0; i < participants.length; i++) {
                const participant = participants[i];
                const isFirstInTeam = i === 0 || participants[i-1].team !== participant.team;

                let teamScore = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (isFirstInTeam) {
                    teamScore = document.getElementById(`team_score_${participant.teamIndex}`).textContent;
                }

                const row = [
                    isFirstInTeam ? `"${participant.team}"` : "",
                    participant.name,
                    document.getElementById(`angle_${i}`).value,
                    document.getElementById(`time_lz_${i}`).value,
                    document.getElementById(`score_lz_${i}`).textContent,
                    document.getElementById(`time_kz_${i}`).value,
                    document.getElementById(`score_kz_${i}`).textContent,
                    document.getElementById(`laps_${i}`).value,
                    document.getElementById(`penalty_gates_${i}`).value,
                    document.getElementById(`penalty_fall_${i}`).value,
                    document.getElementById(`penalty_flip_${i}`).value,
                    document.getElementById(`total_penalty_${i}`).textContent,
                    document.getElementById(`score_track_${i}`).textContent,
                    document.getElementById(`personal_score_${i}`).textContent,
                    isFirstInTeam ? teamScore : ""
                ];

                csvContent += row.join(";") + "\n";
            }

            csvContent += "\n;;;–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞;;;;;;;;;;;;\n";
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª;${document.getElementById('maxAngle').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –õ–ó;${document.getElementById('minTimeLz').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –õ–ó;${document.getElementById('maxScoreLz').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ö–ó;${document.getElementById('minTimeKz').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –ö–ó;${document.getElementById('maxScoreKz').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∫—Ä—É–≥–∏;${document.getElementById('maxLaps').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤;${document.getElementById('minPenalty').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã —Ç—Ä–∞—Å—Å—ã;${document.getElementById('maxScoreTrack').textContent};;;;;;;;;;;`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            const date = new Date().toISOString().slice(0,10).replace(/-/g, '');
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `—Ç—É—Ä–Ω–∏—Ä_–≤–∏—Ö—Ä—å_${date}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('–¢–∞–±–ª–∏—Ü–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ CSV —Ñ–∞–π–ª!');
        }

        // ========== –ó–ê–©–ò–¢–ê ==========
        function initProtection() {
            document.addEventListener('contextmenu', function(e) {
                if (currentMode === 'view') {
                    e.preventDefault();
                    showWarning('–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
                }
                return false;
            });

            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 123 ||
                    (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) ||
                    (e.ctrlKey && e.keyCode === 85)) {
                    e.preventDefault();
                    showWarning('–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω—ã!');
                    return false;
                }
            });

            console.log('%c ‚ö†Ô∏è –¢–£–†–ù–ò–†–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê "–í–ò–•–†–¨" - –û–ù–õ–ê–ô–ù –í–ï–†–°–ò–Ø ‚ö†Ô∏è ', 'color: #2c3e50; font-size: 24px; font-weight: bold;');
            console.log('%c GitHub —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ–±–ª–∞–∫–æ. ', 'color: white; background: #3498db; font-size: 16px;');
        }

        function showWarning(message) {
            const warning = document.getElementById('warningMessage');
            warning.textContent = message;
            warning.style.display = 'block';

            setTimeout(() => {
                warning.style.animation = 'fadeOut 0.3s';
                setTimeout(() => {
                    warning.style.display = 'none';
                    warning.style.animation = '';
                }, 300);
            }, 3000);
        }
    </script>
    <script src="online.js"></script>
</body>
</html>
