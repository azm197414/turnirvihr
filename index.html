<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—É–±–∞ "–í–∏—Ö—Ä—å"</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 95vw;
            margin: 0 auto;
            overflow-x: auto;
        }
        .tournament-table {
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            font-size: 0.85em;
            min-width: 1400px;
            border: 2px solid #2c3e50;
        }
        .tournament-table th, .tournament-table td {
            border: 2px solid #95a5a6;
            padding: 6px 8px;
            text-align: center;
            vertical-align: middle;
            min-width: 70px;
        }
        .tournament-table th {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
            border: 2px solid #34495e;
        }
        .input-cell {
            background-color: #fff;
        }
        .input-cell input {
            width: 90%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
            font-size: 0.9em;
        }
        .input-cell input:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        .result-cell {
            background-color: #e8f4fd;
            font-weight: bold;
            color: #2c3e50;
        }
        .team-header {
            background-color: #ecf0f1;
            font-weight: bold;
        }
        .participant-row {
            background-color: #f8f9fa;
        }
        .controls {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .controls button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
        }
        .controls button:hover {
            background-color: #2980b9;
        }
        .controls button.reset {
            background-color: #e74c3c;
        }
        .controls button.reset:hover {
            background-color: #c0392b;
        }
        .controls button.test {
            background-color: #2ecc71;
        }
        .controls button.test:hover {
            background-color: #27ae60;
        }
        .controls button.export {
            background-color: #9b59b6;
        }
        .controls button.export:hover {
            background-color: #8e44ad;
        }
        .controls button.edit-mode {
            background-color: #f39c12;
        }
        .controls button.edit-mode:hover {
            background-color: #d68910;
        }
        .controls button.view-mode {
            background-color: #7f8c8d;
        }
        .controls button.view-mode:hover {
            background-color: #6c7b7d;
        }
        .notes {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 10px;
            padding: 10px;
            background-color: #ecf0f1;
            border-left: 4px solid #3498db;
        }
        .time-input {
            font-family: monospace;
            font-size: 0.85em;
        }
        .calculated-cell {
            background-color: #e8f6f3;
            font-weight: bold;
        }
        .personal-score {
            background-color: #d5f4e6;
            font-weight: bold;
        }
        .team-score {
            background-color: #fef9e7;
            font-weight: bold;
            font-size: 1.1em;
        }
        .error-cell {
            background-color: #fadbd8;
            color: #c0392b;
            font-weight: bold;
        }
        .formula-note {
            font-size: 0.75em;
            color: #7f8c8d;
            font-style: italic;
        }
        .participant-name {
            white-space: nowrap;
            text-align: left;
            padding-left: 10px;
            font-weight: bold;
        }
        .team-name {
            font-weight: bold;
            font-size: 1em;
        }
        .header-name {
            font-weight: bold;
        }
        .main-title {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .max-min-cell {
            background-color: #d6dbdf;
            font-weight: bold;
        }
        
        /* –°—Ç–∏–ª–∏ –∑–∞—â–∏—Ç—ã */
        .protected {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .warning-message {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 5px;
            z-index: 10000;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –ø–∞—Ä–æ–ª—è */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .password-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 400px;
        }
        .password-form h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .password-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }
        .password-tab {
            flex: 1;
            padding: 10px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
        }
        .password-tab.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }
        .password-input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
            letter-spacing: 2px;
        }
        .password-input:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }
        .password-submit {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        .password-submit:hover {
            background: #2980b9;
        }
        .password-error {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        .password-info {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 20px;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .password-hint {
            color: #95a5a6;
            font-size: 12px;
            margin-top: 15px;
            font-style: italic;
        }
        
        /* –°—Ç–∞—Ç—É—Å —Ä–µ–∂–∏–º–∞ */
        .mode-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-left: auto;
        }
        .mode-status.view {
            background-color: #7f8c8d;
            color: white;
        }
        .mode-status.edit {
            background-color: #f39c12;
            color: white;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ */
        .lock-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }
        .lock-indicator.locked {
            background-color: #e74c3c;
            border-radius: 50%;
        }
        .lock-indicator.unlocked {
            background-color: #2ecc71;
            border-radius: 50%;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
        .view-message {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è -->
    <div id="passwordOverlay" class="password-overlay">
        <div class="password-form">
            <div class="password-tabs">
                <button class="password-tab active" onclick="switchTab('view')">–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                <button class="password-tab" onclick="switchTab('edit')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            </div>
            
            <div id="viewTab">
                <h2>–ü–†–û–°–ú–û–¢–† –¢–ê–ë–õ–ò–¶–´</h2>
                <p>–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è.</p>
                <button id="viewSubmit" class="password-submit" onclick="enterViewMode()">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
                <div class="password-info">
                    <strong>–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:</strong><br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã<br>
                    ‚Ä¢ –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV<br>
                    ‚Ä¢ –†–∞—Å—á–µ—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                </div>
            </div>
            
            <div id="editTab" style="display: none;">
                <h2>–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶–´</h2>
                <p>–î–ª—è –≤–≤–æ–¥–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</p>
                <input type="password" id="passwordInput" class="password-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞" autocomplete="off">
                <div id="passwordError" class="password-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</div>
                <button id="editSubmit" class="password-submit" onclick="enterEditMode()">–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button>
                <div class="password-info">
                    <strong>–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV<br>
                    ‚Ä¢ –î–æ—Å—Ç—É–ø–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                </div>
                <div class="password-hint">–ü–∞—Ä–æ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–∞</div>
            </div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="mainContent" class="container" style="display: none;">
        <div class="main-title">
            –¢–ê–ë–õ–ò–¶–ê –ë–û–õ–¨–®–û–ì–û –ó–ò–ú–ù–ï–ì–û –¢–£–†–ù–ò–†–ê –ö–õ–£–ë–ê –ü–ò–õ–û–¢–û–í –ë–ü–õ–ê "–í–ò–•–†–¨"
        </div>
        
        <div id="viewMessage" class="view-message" style="display: none;">
            üîí <strong>–†–ï–ñ–ò–ú –ü–†–û–°–ú–û–¢–†–ê</strong> - –í—ã –º–æ–∂–µ—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        </div>
        
        <div class="controls">
            <button onclick="calculateAll()">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ</button>
            <button onclick="resetAll()" class="reset" id="resetButton" disabled>–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="fillTestData()" class="test" id="testButton" disabled>–ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="exportToExcel()" class="export">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
            
            <div id="modeStatus" class="mode-status view">
                <span class="lock-indicator locked" id="lockIndicator"></span>
                <span id="modeText">–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
            </div>
            
            <button onclick="switchToEditMode()" class="edit-mode" id="editModeButton">–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button>
            <button onclick="logout()" class="view-mode" id="logoutButton">–í—ã–π—Ç–∏</button>
        </div>
        
        <table class="tournament-table" id="tournamentTable">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
            <tr>
                <th rowspan="3" class="header-name">–ö–æ–º–∞–Ω–¥–∞</th>
                <th rowspan="3" class="header-name">–£—á–∞—Å—Ç–Ω–∏–∫</th>
                <th colspan="3" class="header-name">–õ–∏—Ç–æ—Ñ—Ñ</th>
                <th colspan="2" class="header-name">–ö–≤–∞–¥—Ä–æ—Å–∏–º</th>
                <th colspan="3" class="header-name">–¢—Ä–∞—Å—Å–∞</th>
                <th rowspan="3" class="header-name">–ë–∞–ª–ª—ã –õ–ó</th>
                <th rowspan="3" class="header-name">–ë–∞–ª–ª—ã –ö–ó</th>
            </tr>
            
            <tr>
                <!-- –õ–∏—Ç–æ—Ñ—Ñ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–£–≥–æ–ª</th>
                <th class="header-name">–í—Ä–µ–º—è (–ú–ú:–°–°:–ú–°)</th>
                <th class="header-name">–ë–∞–ª–ª—ã</th>
                <!-- –ö–≤–∞–¥—Ä–æ—Å–∏–º –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–í—Ä–µ–º—è (–ú–ú:–°–°:–ú–°)</th>
                <th class="header-name">–ë–∞–ª–ª—ã</th>
                <!-- –¢—Ä–∞—Å—Å–∞ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–ö–æ–ª-–≤–æ –∫—Ä—É–≥–æ–≤</th>
                <th class="header-name">–®—Ç—Ä–∞—Ñ</th>
                <th class="header-name">–ë–∞–ª–ª—ã</th>
            </tr>
            
            <tr class="max-min-cell">
                <!-- –õ–∏—Ç–æ—Ñ—Ñ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º—É–º–∞/–º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxAngle">0</span></td>
                <td>–ú–∏–Ω–∏–º—É–º<br><span id="minTimeLz">00:00:00</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreLz">0.00</span></td>
                <!-- –ö–≤–∞–¥—Ä–æ—Å–∏–º —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∏–Ω–∏–º—É–º<br><span id="minTimeKz">00:00:00</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreKz">0.00</span></td>
                <!-- –¢—Ä–∞—Å—Å–∞ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º—É–º–∞/–º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxLaps">0</span></td>
                <td>–ú–∏–Ω–∏–º—É–º<br><span id="minPenalty">0</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreTrack">0.00</span></td>
                <!-- –ü—É—Å—Ç—ã–µ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è -->
                <td></td>
                <td></td>
            </tr>
            
            <!-- –î–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è JavaScript -->
        </table>
        
        <div class="notes">
            <p><strong>–§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–æ–≤:</strong></p>
            <ul>
                <li><strong>–ë–∞–ª–ª—ã –õ–∏—Ç–æ—Ñ—Ñ:</strong> = (–£–≥–æ–ª/–ú–ê–ö–°_–£–≥–æ–ª * 70) + (–ú–ò–ù_–í—Ä–µ–º—è_–õ–ó/–í—Ä–µ–º—è_–õ–ó * 30)</li>
                <li><strong>–ë–∞–ª–ª—ã –ö–≤–∞–¥—Ä–æ—Å–∏–º:</strong> = (–ú–ò–ù_–í—Ä–µ–º—è_–ö–ó * 100) / –í—Ä–µ–º—è_–ö–ó</li>
                <li><strong>–ë–∞–ª–ª—ã –¢—Ä–∞—Å—Å—ã:</strong> = (–ö—Ä—É–≥–∏/–ú–ê–ö–°_–ö—Ä—É–≥–∏ * 100) - –®—Ç—Ä–∞—Ñ</li>
                <li><strong>–ë–∞–ª–ª—ã –õ–ó (–ª–∏—á–Ω—ã–π –∑–∞—á–µ—Ç):</strong> = –ë–∞–ª–ª—ã_–õ–∏—Ç–æ—Ñ—Ñ + –ë–∞–ª–ª—ã_–ö–≤–∞–¥—Ä–æ—Å–∏–º + –ë–∞–ª–ª—ã_–¢—Ä–∞—Å—Å—ã</li>
                <li><strong>–ë–∞–ª–ª—ã –ö–ó (–∫–æ–º–∞–Ω–¥–Ω—ã–π –∑–∞—á–µ—Ç):</strong> = –°—É–º–º–∞ –ë–∞–ª–ª–æ–≤_–õ–ó –æ–±–æ–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã (–æ–¥–Ω–∞ —è—á–µ–π–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É)</li>
                <li><strong>–û–ñ–ò–î–ê–ù–ò–ï:</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –¥–µ–ª–µ–Ω–∏–∏ –Ω–∞ –Ω–æ–ª—å</li>
            </ul>
        </div>
    </div>

    <div id="warningMessage" class="warning-message"></div>

    <script>
        // ========== –°–ò–°–¢–ï–ú–ê –î–û–°–¢–£–ü–ê ==========
        
        // –ü–∞—Ä–æ–ª—å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
        const EDIT_PASSWORD = "–í–∏—Ö—Ä—å2024"; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å
        
        // –ö–ª—é—á–∏ –¥–ª—è localStorage
        const STORAGE_KEYS = {
            DATA: '—Ç—É—Ä–Ω–∏—Ä_–¥–∞–Ω–Ω—ã–µ',
            MODE: '—Ç—É—Ä–Ω–∏—Ä_—Ä–µ–∂–∏–º',
            EDIT_SESSION: '—Ç—É—Ä–Ω–∏—Ä_—Ä–µ–¥–∞–∫—Ç–æ—Ä_—Å–µ—Å—Å–∏—è'
        };
        
        // –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
        let currentMode = 'view'; // 'view' –∏–ª–∏ 'edit'
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –≤ —Ñ–æ—Ä–º–µ –ø–∞—Ä–æ–ª—è
        function switchTab(tab) {
            document.querySelectorAll('.password-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('viewTab').style.display = 'none';
            document.getElementById('editTab').style.display = 'none';
            
            if (tab === 'view') {
                document.querySelector('.password-tab[onclick="switchTab(\'view\')"]').classList.add('active');
                document.getElementById('viewTab').style.display = 'block';
            } else {
                document.querySelector('.password-tab[onclick="switchTab(\'edit\')"]').classList.add('active');
                document.getElementById('editTab').style.display = 'block';
                document.getElementById('passwordInput').focus();
            }
        }
        
        // –í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function enterViewMode() {
            currentMode = 'view';
            showMainContent();
        }
        
        // –í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function enterEditMode() {
            const passwordInput = document.getElementById('passwordInput');
            const passwordError = document.getElementById('passwordError');
            const enteredPassword = passwordInput.value.trim();
            
            if (enteredPassword === EDIT_PASSWORD) {
                passwordError.style.display = 'none';
                passwordInput.value = '';
                currentMode = 'edit';
                // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ—Å—Å–∏—é —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
                localStorage.setItem(STORAGE_KEYS.EDIT_SESSION, 'active');
                showMainContent();
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
                if (navigator.vibrate) navigator.vibrate(200);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
        function showMainContent() {
            document.getElementById('passwordOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∂–∏–º
            localStorage.setItem(STORAGE_KEYS.MODE, currentMode);
            
            // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
            setupInterfaceForMode();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É
            initTable();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–µ–∂–∏–º–∞
        function setupInterfaceForMode() {
            const viewMessage = document.getElementById('viewMessage');
            const resetButton = document.getElementById('resetButton');
            const testButton = document.getElementById('testButton');
            const editModeButton = document.getElementById('editModeButton');
            const modeStatus = document.getElementById('modeStatus');
            const modeText = document.getElementById('modeText');
            const lockIndicator = document.getElementById('lockIndicator');
            
            if (currentMode === 'view') {
                // –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                viewMessage.style.display = 'block';
                resetButton.disabled = true;
                testButton.disabled = true;
                editModeButton.style.display = 'inline-block';
                modeStatus.className = 'mode-status view';
                modeText.textContent = '–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞';
                lockIndicator.className = 'lock-indicator locked';
                
                // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
                disableInputFields();
            } else {
                // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                viewMessage.style.display = 'none';
                resetButton.disabled = false;
                testButton.disabled = false;
                editModeButton.style.display = 'none';
                modeStatus.className = 'mode-status edit';
                modeText.textContent = '–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
                lockIndicator.className = 'lock-indicator unlocked';
                
                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
                enableInputFields();
            }
        }
        
        // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
        function disableInputFields() {
            const inputs = document.querySelectorAll('.input-cell input');
            inputs.forEach(input => {
                input.disabled = true;
                input.title = '–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.';
            });
        }
        
        // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
        function enableInputFields() {
            const inputs = document.querySelectorAll('.input-cell input');
            inputs.forEach(input => {
                input.disabled = false;
                input.title = '';
            });
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∏–∑ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞)
        function switchToEditMode() {
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('passwordOverlay').style.display = 'flex';
            switchTab('edit');
            document.getElementById('passwordInput').focus();
        }
        
        // –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                // –û—á–∏—Å—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
                localStorage.removeItem(STORAGE_KEYS.EDIT_SESSION);
                
                // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('passwordOverlay').style.display = 'flex';
                switchTab('view');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
        function checkSavedSession() {
            const editSession = localStorage.getItem(STORAGE_KEYS.EDIT_SESSION);
            const savedMode = localStorage.getItem(STORAGE_KEYS.MODE);
            
            if (editSession === 'active') {
                // –ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
                currentMode = 'edit';
                return true;
            } else if (savedMode === 'view' || savedMode === 'edit') {
                // –ï—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                currentMode = savedMode;
                if (currentMode === 'edit') {
                    // –ï—Å–ª–∏ –±—ã–ª —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞
                    currentMode = 'view';
                }
                return true;
            }
            return false;
        }
        
        // –ê–≤—Ç–æ–≤—ã—Ö–æ–¥ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ 4 —á–∞—Å–∞
        setTimeout(() => {
            if (localStorage.getItem(STORAGE_KEYS.EDIT_SESSION) === 'active') {
                localStorage.removeItem(STORAGE_KEYS.EDIT_SESSION);
                localStorage.setItem(STORAGE_KEYS.MODE, 'view');
                
                // –ï—Å–ª–∏ —Å–µ–π—á–∞—Å –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä
                if (currentMode === 'edit') {
                    currentMode = 'view';
                    setupInterfaceForMode();
                    showWarning('–°–µ—Å—Å–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∏—Å—Ç–µ–∫–ª–∞. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω –≤ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.');
                }
            }
        }, 4 * 60 * 60 * 1000); // 4 —á–∞—Å–∞
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –ø–∞—Ä–æ–ª—è
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    enterEditMode();
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
            if (checkSavedSession()) {
                showMainContent();
            } else {
                // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
                document.getElementById('passwordOverlay').style.display = 'flex';
                switchTab('view');
            }
            
            // –ó–∞—â–∏—Ç–∞ –æ—Ç DevTools
            initProtection();
        });
        
        // ========== –ó–ê–©–ò–¢–ê –û–¢ –ò–ó–ú–ï–ù–ï–ù–ò–ô ==========
        
        function initProtection() {
            // 1. –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
            document.addEventListener('contextmenu', function(e) {
                if (currentMode === 'view') {
                    e.preventDefault();
                    showWarning('–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
                }
                return false;
            });
            
            // 2. –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 123 || // F12
                    (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) || // Ctrl+Shift+I/J/C
                    (e.ctrlKey && e.keyCode === 85)) { // Ctrl+U
                    e.preventDefault();
                    showWarning('–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω—ã!');
                    return false;
                }
            });
            
            // 3. –°–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª–∏
            console.log('%c ‚ö†Ô∏è –¢–£–†–ù–ò–†–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê "–í–ò–•–†–¨" ‚ö†Ô∏è ', 'color: #2c3e50; font-size: 24px; font-weight: bold;');
            console.log('%c –î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è –≤–≤–æ–¥–∞. ', 'color: white; background: #3498db; font-size: 16px;');
        }
        
        function showWarning(message) {
            const warning = document.getElementById('warningMessage');
            warning.textContent = message;
            warning.style.display = 'block';
            
            setTimeout(() => {
                warning.style.animation = 'fadeOut 0.3s';
                setTimeout(() => {
                    warning.style.display = 'none';
                    warning.style.animation = '';
                }, 300);
            }, 3000);
        }
        
        // ========== –î–ê–ù–ù–´–ï –ò –õ–û–ì–ò–ö–ê –¢–ê–ë–õ–ò–¶–´ ==========
        
        const participants = [
            { team: "–ò–Ω—Ç–µ–Ω—Å–∏–≤", name: "–ö—Å–µ–Ω–∏—è –õ.", id: 1, teamIndex: 0 },
            { team: "–ò–Ω—Ç–µ–Ω—Å–∏–≤", name: "–°–≤—è—Ç–æ—Å–ª–∞–≤ –ï.", id: 2, teamIndex: 0 },
            { team: "–ü—Ä–æ—Ä—ã–≤", name: "–ù–∏–∫–∏—Ç–∞ –£.", id: 3, teamIndex: 1 },
            { team: "–ü—Ä–æ—Ä—ã–≤", name: "–í–∞—Ä—è –ê.", id: 4, teamIndex: 1 },
            { team: "–ê–ª—å—Ñ–∞", name: "–î–º–∏—Ç—Ä–∏–π –í.", id: 5, teamIndex: 2 },
            { team: "–ê–ª—å—Ñ–∞", name: "–ò–≤–∞–Ω –§.", id: 6, teamIndex: 2 },
            { team: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", name: "–°–∞–≤–µ–ª–∏–π –°.", id: 7, teamIndex: 3 },
            { team: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", name: "–ë–æ–≥–¥–∞–Ω –ï.", id: 8, teamIndex: 3 },
            { team: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è", name: "–ê—Ä—Ç–µ–º –ü.", id: 9, teamIndex: 4 },
            { team: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è", name: "–î–∞–Ω–∏–ª–∞ –õ.", id: 10, teamIndex: 4 }
        ];
        
        function initTable() {
            createTable();
            loadFromLocalStorage();
            protectElements();
            
            // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
            if (currentMode === 'view') {
                disableInputFields();
            } else {
                enableInputFields();
            }
        }
        
        function createTable() {
            const table = document.getElementById('tournamentTable');
            
            while (table.rows.length > 3) {
                table.deleteRow(3);
            }
            
            participants.forEach((participant, index) => {
                const row = table.insertRow();
                const isFirstInTeam = index === 0 || participants[index-1].team !== participant.team;
                
                if (isFirstInTeam) {
                    row.className = 'team-header';
                } else {
                    row.className = 'participant-row';
                }
                
                if (isFirstInTeam) {
                    row.innerHTML = `
                        <td rowspan="2" class="team-name">"${participant.team}"</td>
                        <td class="participant-name">${participant.name}</td>
                        <td class="input-cell"><input type="number" id="angle_${index}" min="0" max="90" value="0" step="1" placeholder="0-90¬∞"></td>
                        <td class="input-cell"><input type="text" id="time_lz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_lz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="text" id="time_kz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_kz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="number" id="laps_${index}" min="0" value="0" placeholder="0+"></td>
                        <td class="input-cell"><input type="number" id="penalty_${index}" min="0" value="0" placeholder="0+"></td>
                        <td class="result-cell" id="score_track_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="personal-score" id="personal_score_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td rowspan="2" class="team-score" id="team_score_${participant.teamIndex}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td class="participant-name">${participant.name}</td>
                        <td class="input-cell"><input type="number" id="angle_${index}" min="0" max="90" value="0" step="1" placeholder="0-90¬∞"></td>
                        <td class="input-cell"><input type="text" id="time_lz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_lz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="text" id="time_kz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_kz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="number" id="laps_${index}" min="0" value="0" placeholder="0+"></td>
                        <td class="input-cell"><input type="number" id="penalty_${index}" min="0" value="0" placeholder="0+"></td>
                        <td class="result-cell" id="score_track_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="personal-score" id="personal_score_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                    `;
                }
            });
            
            addInputEventListeners();
        }
        
        function addInputEventListeners() {
            for (let i = 0; i < participants.length; i++) {
                const inputs = [
                    `angle_${i}`, `time_lz_${i}`, `time_kz_${i}`, `laps_${i}`, `penalty_${i}`
                ];
                
                inputs.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', () => {
                            if (currentMode === 'edit') {
                                calculateAll();
                                saveToLocalStorage();
                            }
                        });
                        
                        if (id.startsWith('time_')) {
                            input.addEventListener('blur', function() {
                                if (currentMode === 'edit') {
                                    formatTimeInput(this);
                                }
                            });
                        }
                    }
                });
            }
        }
        
        function protectElements() {
            const elements = document.querySelectorAll(
                '.result-cell, .personal-score, .team-score, .calculated-cell, .max-min-cell, .header-name'
            );
            elements.forEach(el => {
                el.classList.add('protected');
            });
        }
        
        function formatTimeInput(input) {
            let value = input.value.trim();
            if (!value) {
                input.value = '00:00:00';
                return;
            }
            value = value.replace(/[^\d]/g, '');
            while (value.length < 6) value = '0' + value;
            value = value.substring(0, 6);
            const minutes = value.substring(0, 2);
            const seconds = value.substring(2, 4);
            const milliseconds = value.substring(4, 6);
            input.value = `${minutes}:${seconds}:${milliseconds}`;
        }
        
        function timeToSeconds(timeStr) {
            if (!timeStr || timeStr === '00:00:00') return 0;
            const parts = timeStr.split(':');
            if (parts.length !== 3) return 0;
            const minutes = parseInt(parts[0]) || 0;
            const seconds = parseInt(parts[1]) || 0;
            const milliseconds = parseInt(parts[2]) || 0;
            if (isNaN(minutes) || isNaN(seconds) || isNaN(milliseconds)) return 0;
            return minutes * 60 + seconds + (milliseconds / 100);
        }
        
        function secondsToTime(seconds) {
            if (seconds <= 0) return '00:00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            const ms = Math.round((seconds - Math.floor(seconds)) * 100);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}:${ms.toString().padStart(2, '0')}`;
        }
        
        function calculateAll() {
            const participantsData = [];
            
            for (let i = 0; i < participants.length; i++) {
                participantsData.push({
                    index: i,
                    angle: parseFloat(document.getElementById(`angle_${i}`).value) || 0,
                    timeLz: timeToSeconds(document.getElementById(`time_lz_${i}`).value),
                    timeKz: timeToSeconds(document.getElementById(`time_kz_${i}`).value),
                    laps: parseFloat(document.getElementById(`laps_${i}`).value) || 0,
                    penalty: parseFloat(document.getElementById(`penalty_${i}`).value) || 0,
                    teamIndex: participants[i].teamIndex
                });
            }
            
            const maxAngle = Math.max(...participantsData.filter(p => p.angle > 0).map(p => p.angle));
            const minTimeLz = Math.min(...participantsData.filter(p => p.timeLz > 0).map(p => p.timeLz));
            const minTimeKz = Math.min(...participantsData.filter(p => p.timeKz > 0).map(p => p.timeKz));
            const maxLaps = Math.max(...participantsData.filter(p => p.laps > 0).map(p => p.laps));
            const minPenalty = Math.min(...participantsData.filter(p => p.penalty > 0).map(p => p.penalty));
            
            document.getElementById('maxAngle').textContent = maxAngle > 0 ? maxAngle : '0';
            document.getElementById('minTimeLz').textContent = minTimeLz > 0 ? secondsToTime(minTimeLz) : '00:00:00';
            document.getElementById('minTimeKz').textContent = minTimeKz > 0 ? secondsToTime(minTimeKz) : '00:00:00';
            document.getElementById('maxLaps').textContent = maxLaps > 0 ? maxLaps : '0';
            document.getElementById('minPenalty').textContent = minPenalty > 0 ? minPenalty : '0';
            
            let maxScoreLz = 0, maxScoreKz = 0, maxScoreTrack = 0;
            
            participantsData.forEach(data => {
                const i = data.index;
                
                let scoreLz = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (maxAngle > 0 && data.angle > 0 && minTimeLz > 0 && data.timeLz > 0) {
                    const calculated = ((data.angle / maxAngle) * 70) + ((minTimeLz / data.timeLz) * 30);
                    scoreLz = calculated.toFixed(2);
                    maxScoreLz = Math.max(maxScoreLz, calculated);
                }
                
                let scoreKz = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (minTimeKz > 0 && data.timeKz > 0) {
                    const calculated = (minTimeKz * 100) / data.timeKz;
                    scoreKz = calculated.toFixed(2);
                    maxScoreKz = Math.max(maxScoreKz, calculated);
                }
                
                let scoreTrack = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (maxLaps > 0 && data.laps > 0) {
                    const calculated = ((data.laps / maxLaps) * 100) - data.penalty;
                    scoreTrack = calculated > 0 ? calculated.toFixed(2) : "0.00";
                    maxScoreTrack = Math.max(maxScoreTrack, calculated > 0 ? calculated : 0);
                }
                
                let personalScore = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (scoreLz !== "–û–ñ–ò–î–ê–ù–ò–ï" && scoreKz !== "–û–ñ–ò–î–ê–ù–ò–ï" && scoreTrack !== "–û–ñ–ò–î–ê–ù–ò–ï") {
                    personalScore = (parseFloat(scoreLz) + parseFloat(scoreKz) + parseFloat(scoreTrack)).toFixed(2);
                }
                
                data.personalScore = personalScore === "–û–ñ–ò–î–ê–ù–ò–ï" ? 0 : parseFloat(personalScore);
                
                document.getElementById(`score_lz_${i}`).textContent = scoreLz;
                document.getElementById(`score_lz_${i}`).className = scoreLz === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";
                document.getElementById(`score_kz_${i}`).textContent = scoreKz;
                document.getElementById(`score_kz_${i}`).className = scoreKz === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";
                document.getElementById(`score_track_${i}`).textContent = scoreTrack;
                document.getElementById(`score_track_${i}`).className = scoreTrack === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";
                document.getElementById(`personal_score_${i}`).textContent = personalScore;
                document.getElementById(`personal_score_${i}`).className = personalScore === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "personal-score";
            });
            
            document.getElementById('maxScoreLz').textContent = maxScoreLz.toFixed(2);
            document.getElementById('maxScoreKz').textContent = maxScoreKz.toFixed(2);
            document.getElementById('maxScoreTrack').textContent = maxScoreTrack.toFixed(2);
            
            const teamScores = {};
            participantsData.forEach(data => {
                if (!teamScores[data.teamIndex]) teamScores[data.teamIndex] = 0;
                teamScores[data.teamIndex] += data.personalScore;
            });
            
            for (const [teamIndex, teamScore] of Object.entries(teamScores)) {
                document.getElementById(`team_score_${teamIndex}`).textContent = teamScore.toFixed(2);
                document.getElementById(`team_score_${teamIndex}`).className = "team-score";
            }
            
            for (let i = 0; i < 5; i++) {
                if (!teamScores[i]) {
                    document.getElementById(`team_score_${i}`).textContent = "–û–ñ–ò–î–ê–ù–ò–ï";
                    document.getElementById(`team_score_${i}`).className = "error-cell";
                }
            }
        }
        
        function saveToLocalStorage() {
            const data = {};
            for (let i = 0; i < participants.length; i++) {
                data[`participant_${i}`] = {
                    angle: document.getElementById(`angle_${i}`).value,
                    timeLz: document.getElementById(`time_lz_${i}`).value,
                    timeKz: document.getElementById(`time_kz_${i}`).value,
                    laps: document.getElementById(`laps_${i}`).value,
                    penalty: document.getElementById(`penalty_${i}`).value
                };
            }
            localStorage.setItem(STORAGE_KEYS.DATA, JSON.stringify(data));
        }
        
        function loadFromLocalStorage() {
            const saved = localStorage.getItem(STORAGE_KEYS.DATA);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    for (let i = 0; i < participants.length; i++) {
                        if (data[`participant_${i}`]) {
                            const p = data[`participant_${i}`];
                            document.getElementById(`angle_${i}`).value = p.angle || 0;
                            document.getElementById(`time_lz_${i}`).value = p.timeLz || '00:00:00';
                            document.getElementById(`time_kz_${i}`).value = p.timeKz || '00:00:00';
                            document.getElementById(`laps_${i}`).value = p.laps || 0;
                            document.getElementById(`penalty_${i}`).value = p.penalty || 0;
                        }
                    }
                    calculateAll();
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                }
            }
        }
        
        function resetAll() {
            if (currentMode !== 'edit') {
                showWarning('–¢–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.');
                return;
            }
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –í—Å–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                for (let i = 0; i < participants.length; i++) {
                    document.getElementById(`angle_${i}`).value = 0;
                    document.getElementById(`time_lz_${i}`).value = '00:00:00';
                    document.getElementById(`time_kz_${i}`).value = '00:00:00';
                    document.getElementById(`laps_${i}`).value = 0;
                    document.getElementById(`penalty_${i}`).value = 0;
                    
                    ['score_lz_', 'score_kz_', 'score_track_', 'personal_score_'].forEach(prefix => {
                        document.getElementById(`${prefix}${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                        document.getElementById(`${prefix}${i}`).className = 'error-cell';
                    });
                }
                
                for (let i = 0; i < 5; i++) {
                    document.getElementById(`team_score_${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                    document.getElementById(`team_score_${i}`).className = 'error-cell';
                }
                
                ['maxAngle', 'maxScoreLz', 'maxScoreKz', 'maxLaps', 'maxScoreTrack'].forEach(id => {
                    document.getElementById(id).textContent = id === 'maxAngle' || id === 'maxLaps' ? '0' : '0.00';
                });
                
                ['minTimeLz', 'minTimeKz'].forEach(id => {
                    document.getElementById(id).textContent = '00:00:00';
                });
                
                document.getElementById('minPenalty').textContent = '0';
                
                localStorage.removeItem(STORAGE_KEYS.DATA);
                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã!');
            }
        }
        
        function fillTestData() {
            if (currentMode !== 'edit') {
                showWarning('–¢–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.');
                return;
            }
            
            const testData = [
                { angle: 51, timeLz: '00:45:00', timeKz: '00:00:00', laps: 0, penalty: 0 },
                { angle: 63, timeLz: '00:53:00', timeKz: '00:00:00', laps: 0, penalty: 0 },
                { angle: 0, timeLz: '00:00:00', timeKz: '00:00:00', laps: 0, penalty: 0 },
                { angle: 0, timeLz: '00:00:00', timeKz: '00:00:00', laps: 0, penalty: 0 },
                { angle: 0, timeLz: '00:00:00', timeKz: '00:00:00', laps: 0, penalty: 0 },
                { angle: 0, timeLz: '00:00:00', timeKz: '00:00:00', laps: 0, penalty: 0 },
                { angle: 45, timeLz: '00:48:30', timeKz: '01:30:45', laps: 10, penalty: 2 },
                { angle: 38, timeLz: '00:52:15', timeKz: '01:35:20', laps: 8, penalty: 1 },
                { angle: 55, timeLz: '00:42:10', timeKz: '01:25:30', laps: 12, penalty: 3 },
                { angle: 42, timeLz: '00:55:40', timeKz: '01:40:15', laps: 9, penalty: 2 }
            ];
            
            for (let i = 0; i < participants.length; i++) {
                const data = testData[i];
                document.getElementById(`angle_${i}`).value = data.angle;
                document.getElementById(`time_lz_${i}`).value = data.timeLz;
                document.getElementById(`time_kz_${i}`).value = data.timeKz;
                document.getElementById(`laps_${i}`).value = data.laps;
                document.getElementById(`penalty_${i}`).value = data.penalty;
            }
            
            calculateAll();
            saveToLocalStorage();
            alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }
        
        function exportToExcel() {
            let csvContent = "data:text/csv;charset=utf-8,";
            const headers = [
                "–ö–æ–º–∞–Ω–¥–∞", "–£—á–∞—Å—Ç–Ω–∏–∫", "–£–≥–æ–ª (–õ–∏—Ç–æ—Ñ—Ñ)", "–í—Ä–µ–º—è –õ–ó (–ú–ú:–°–°:–ú–°)", "–ë–∞–ª–ª—ã –õ–ó",
                "–í—Ä–µ–º—è –ö–ó (–ú–ú:–°–°:–ú–°)", "–ë–∞–ª–ª—ã –ö–ó", "–ö—Ä—É–≥–∏ (–¢—Ä–∞—Å—Å–∞)", "–®—Ç—Ä–∞—Ñ (–¢—Ä–∞—Å—Å–∞)",
                "–ë–∞–ª–ª—ã –¢—Ä–∞—Å—Å—ã", "–ë–∞–ª–ª—ã –õ–ó (–ª–∏—á–Ω—ã–π)", "–ë–∞–ª–ª—ã –ö–ó (–∫–æ–º–∞–Ω–¥–Ω—ã–π)"
            ];
            
            csvContent += headers.join(";") + "\n";
            
            for (let i = 0; i < participants.length; i++) {
                const participant = participants[i];
                const isFirstInTeam = i === 0 || participants[i-1].team !== participant.team;
                
                let teamScore = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (isFirstInTeam) {
                    teamScore = document.getElementById(`team_score_${participant.teamIndex}`).textContent;
                }
                
                const row = [
                    isFirstInTeam ? `"${participant.team}"` : "",
                    participant.name,
                    document.getElementById(`angle_${i}`).value,
                    document.getElementById(`time_lz_${i}`).value,
                    document.getElementById(`score_lz_${i}`).textContent,
                    document.getElementById(`time_kz_${i}`).value,
                    document.getElementById(`score_kz_${i}`).textContent,
                    document.getElementById(`laps_${i}`).value,
                    document.getElementById(`penalty_${i}`).value,
                    document.getElementById(`score_track_${i}`).textContent,
                    document.getElementById(`personal_score_${i}`).textContent,
                    isFirstInTeam ? teamScore : ""
                ];
                
                csvContent += row.join(";") + "\n";
            }
            
            csvContent += "\n;;;–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞;;;;;;;;\n";
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª;${document.getElementById('maxAngle').textContent};;;;;;;;\n`;
            csvContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –õ–ó;${document.getElementById('minTimeLz').textContent};;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –õ–ó;${document.getElementById('maxScoreLz').textContent};;;;;;;;\n`;
            csvContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ö–ó;${document.getElementById('minTimeKz').textContent};;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –ö–ó;${document.getElementById('maxScoreKz').textContent};;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∫—Ä—É–≥–∏;${document.getElementById('maxLaps').textContent};;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã —Ç—Ä–∞—Å—Å—ã;${document.getElementById('maxScoreTrack').textContent};;;;;;;;`;
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            const date = new Date().toISOString().slice(0,10).replace(/-/g, '');
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `—Ç—É—Ä–Ω–∏—Ä_–≤–∏—Ö—Ä—å_${date}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('–¢–∞–±–ª–∏—Ü–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ CSV —Ñ–∞–π–ª!');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (–¥–ª—è —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞)
        setInterval(() => {
            if (currentMode === 'view') {
                calculateAll();
            }
        }, 60000); // 1 –º–∏–Ω—É—Ç–∞
    </script>
</body>
</html>
