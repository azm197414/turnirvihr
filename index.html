<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–ª—É–±–∞ "–í–∏—Ö—Ä—å"</title>
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ ... */
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞ */
.online-controls {
    background: #f8f9fa;
    border-radius: 5px;
    padding: 10px;
    margin: 15px 0;
    border: 2px solid #3498db;
}

.online-controls button {
    transition: all 0.3s;
}

.online-controls button:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 5px rgba(0,0,0,0.2);
}

.online-controls button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è -->
    <div id="passwordOverlay" class="password-overlay">
        <div class="password-form">
            <div class="password-tabs">
                <button class="password-tab active" onclick="switchTab('view')">–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                <button class="password-tab" onclick="switchTab('edit')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            </div>

            <div id="viewTab">
                <h2>–ü–†–û–°–ú–û–¢–† –¢–ê–ë–õ–ò–¶–´</h2>
                <p>–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è.</p>
                <button id="viewSubmit" class="password-submit" onclick="enterViewMode()">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
                <div class="password-info">
                    <strong>–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:</strong><br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã<br>
                    ‚Ä¢ –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV<br>
                    ‚Ä¢ –†–∞—Å—á–µ—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                </div>
            </div>

            <div id="editTab" style="display: none;">
                <h2>–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶–´</h2>
                <p>–î–ª—è –≤–≤–æ–¥–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</p>
                <input type="password" id="passwordInput" class="password-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞" autocomplete="off">
                <div id="passwordError" class="password-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</div>
                <button id="editSubmit" class="password-submit" onclick="enterEditMode()">–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button>
                <div class="password-info">
                    <strong>–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong><br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ<br>
                    ‚Ä¢ –ú–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ CSV<br>
                    ‚Ä¢ –î–æ—Å—Ç—É–ø–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                </div>
                <div class="password-hint">–ü–∞—Ä–æ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä —Ç—É—Ä–Ω–∏—Ä–∞</div>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="mainContent" class="container" style="display: none;">
        <div class="main-title">
            –¢–ê–ë–õ–ò–¶–ê –ë–û–õ–¨–®–û–ì–û –ó–ò–ú–ù–ï–ì–û –¢–£–†–ù–ò–†–ê –ö–õ–£–ë–ê –ü–ò–õ–û–¢–û–í –ë–ü–õ–ê "–í–ò–•–†–¨"
        </div>

        <div id="viewMessage" class="view-message" style="display: none;">
            üîí <strong>–†–ï–ñ–ò–ú –ü–†–û–°–ú–û–¢–†–ê</strong> - –í—ã –º–æ–∂–µ—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        </div>

        <div class="controls">
            <button onclick="calculateAll()">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ</button>
            <button onclick="resetAll()" class="reset" id="resetButton" disabled>–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="fillTestData()" class="test" id="testButton" disabled>–ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="exportToExcel()" class="export">–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>

            <div id="modeStatus" class="mode-status view">
                <span class="lock-indicator locked" id="lockIndicator"></span>
                <span id="modeText">–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
            </div>

            <button onclick="switchToEditMode()" class="edit-mode" id="editModeButton">–í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button>
            <button onclick="logout()" class="view-mode" id="logoutButton">–í—ã–π—Ç–∏</button>
        </div>

        <table class="tournament-table" id="tournamentTable">
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
            <tr>
                <th rowspan="3" class="header-name">–ö–æ–º–∞–Ω–¥–∞</th>
                <th rowspan="3" class="header-name">–£—á–∞—Å—Ç–Ω–∏–∫</th>
                <th colspan="3" class="header-name">–õ–∏—Ç–æ—Ñ—Ñ</th>
                <th colspan="2" class="header-name">–ö–≤–∞–¥—Ä–æ—Å–∏–º</th>
                <th colspan="6" class="header-name">–†–µ–∞–ª—å–Ω–∞—è —Ç—Ä–∞—Å—Å–∞</th>
                <th rowspan="3" class="header-name">–ë–∞–ª–ª—ã –õ–ó</th>
                <th rowspan="3" class="header-name">–ë–∞–ª–ª—ã –ö–ó</th>
            </tr>

            <tr>
                <!-- –õ–∏—Ç–æ—Ñ—Ñ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–£–≥–æ–ª</th>
                <th class="header-name">–í—Ä–µ–º—è (–ú–ú:–°–°:–ú–°)</th>
                <th class="header-name">–ë–∞–ª–ª—ã</th>
                <!-- –ö–≤–∞–¥—Ä–æ—Å–∏–º –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–í—Ä–µ–º—è (–ú–ú:–°–°:–ú–°)</th>
                <th class="header-name">–ë–∞–ª–ª—ã</th>
                <!-- –¢—Ä–∞—Å—Å–∞ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ -->
                <th class="header-name">–ö–æ–ª-–≤–æ –∫—Ä—É–≥–æ–≤</th>
                <th colspan="3" class="penalty-header">–®—Ç—Ä–∞—Ñ—ã (–∫–æ–ª-–≤–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π)</th>
                <th class="header-name">–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤</th>
                <th class="header-name">–ë–∞–ª–ª—ã —Ç—Ä–∞—Å—Å—ã</th>
            </tr>

            <tr class="max-min-cell">
                <!-- –õ–∏—Ç–æ—Ñ—Ñ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º—É–º–∞/–º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxAngle">0</span></td>
                <td>–ú–∏–Ω–∏–º—É–º<br><span id="minTimeLz">00:00:00</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreLz">0.00</span></td>
                <!-- –ö–≤–∞–¥—Ä–æ—Å–∏–º —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∏–Ω–∏–º—É–º<br><span id="minTimeKz">00:00:00</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreKz">0.00</span></td>
                <!-- –¢—Ä–∞—Å—Å–∞ —Ñ–æ—Ä–º—É–ª—ã –¥–ª—è –º–∞–∫—Å–∏–º—É–º–∞/–º–∏–Ω–∏–º—É–º–∞ -->
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxLaps">0</span></td>
                <td class="penalty-header">–í–æ—Ä–æ—Ç–∞<br>(-5)</td>
                <td class="penalty-header">–ü–∞–¥–µ–Ω–∏–µ<br>(-10)</td>
                <td class="penalty-header">–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç<br>(-20)</td>
                <td>–°—É–º–º–∞<br><span id="minPenalty">0</span></td>
                <td>–ú–∞–∫—Å–∏–º—É–º<br><span id="maxScoreTrack">0.00</span></td>
            </tr>

            <!-- –î–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±—É–¥—É—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è JavaScript -->
        </table>

        <div class="notes">
            <p><strong>–§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–æ–≤ (—Å—Ç—Ä–æ–≥–æ –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É):</strong></p>
            <ul>
                <li><strong>–ë–∞–ª–ª—ã –õ–∏—Ç–æ—Ñ—Ñ:</strong> = (–£–≥–æ–ª/–ú–ê–ö–°_–£–≥–æ–ª √ó 70) + (–ú–ò–ù_–í—Ä–µ–º—è_–õ–ó/–í—Ä–µ–º—è_–õ–ó √ó 30)</li>
                <li><strong>–ë–∞–ª–ª—ã –ö–≤–∞–¥—Ä–æ—Å–∏–º:</strong> = (–ú–ò–ù_–í—Ä–µ–º—è_–ö–ó √ó 100) / –í—Ä–µ–º—è_–ö–ó</li>
                <li><strong>–ë–∞–∑–æ–≤—ã–µ –±–∞–ª–ª—ã –¢—Ä–∞—Å—Å—ã:</strong> = (–ö—Ä—É–≥–∏/–ú–ê–ö–°_–ö—Ä—É–≥–∏ √ó 100)</li>
                <li><strong>–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤:</strong> = (–í–æ—Ä–æ—Ç–∞ √ó 5) + (–ü–∞–¥–µ–Ω–∏–µ √ó 10) + (–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç √ó 20)</li>
                <li><strong>–ë–∞–ª–ª—ã –¢—Ä–∞—Å—Å—ã:</strong> = –ë–∞–∑–æ–≤—ã–µ_–±–∞–ª–ª—ã ‚àí –°—É–º–º–∞_—à—Ç—Ä–∞—Ñ–æ–≤</li>
                <li><strong>–ë–∞–ª–ª—ã –õ–ó (–ª–∏—á–Ω—ã–π –∑–∞—á–µ—Ç):</strong> = –ë–∞–ª–ª—ã_–õ–∏—Ç–æ—Ñ—Ñ + –ë–∞–ª–ª—ã_–ö–≤–∞–¥—Ä–æ—Å–∏–º + –ë–∞–ª–ª—ã_–¢—Ä–∞—Å—Å—ã</li>
                <li><strong>–ë–∞–ª–ª—ã –ö–ó (–∫–æ–º–∞–Ω–¥–Ω—ã–π –∑–∞—á–µ—Ç):</strong> = –°—É–º–º–∞ –ë–∞–ª–ª–æ–≤_–õ–ó –æ–±–æ–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã (–æ–¥–Ω–∞ —è—á–µ–π–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É)</li>
                <li><strong>–û–ñ–ò–î–ê–ù–ò–ï:</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –¥–µ–ª–µ–Ω–∏–∏ –Ω–∞ –Ω–æ–ª—å</li>
            </ul>
            <p><strong>–®—Ç—Ä–∞—Ñ—ã –ø–æ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—É:</strong> –í—Ä–µ–∑–∞–Ω–∏–µ –≤ –≤–æ—Ä–æ—Ç–∞ (-5), –ü–∞–¥–µ–Ω–∏–µ (-10), –ü–∞–¥–µ–Ω–∏–µ —Å –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–æ–º (-20)</p>
        </div>
    </div>

    <div id="warningMessage" class="warning-message"></div>

    <script>
        // ========== –°–ò–°–¢–ï–ú–ê –î–û–°–¢–£–ü–ê ==========

        // –ü–∞—Ä–æ–ª—å –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
        const EDIT_PASSWORD = "–í–∏—Ö—Ä—å2024";

        // –ö–ª—é—á–∏ –¥–ª—è localStorage
        const STORAGE_KEYS = {
            DATA: '—Ç—É—Ä–Ω–∏—Ä_–¥–∞–Ω–Ω—ã–µ',
            MODE: '—Ç—É—Ä–Ω–∏—Ä_—Ä–µ–∂–∏–º',
            EDIT_SESSION: '—Ç—É—Ä–Ω–∏—Ä_—Ä–µ–¥–∞–∫—Ç–æ—Ä_—Å–µ—Å—Å–∏—è'
        };

        // –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
        let currentMode = 'view';

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –≤ —Ñ–æ—Ä–º–µ –ø–∞—Ä–æ–ª—è
        function switchTab(tab) {
            document.querySelectorAll('.password-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('viewTab').style.display = 'none';
            document.getElementById('editTab').style.display = 'none';

            if (tab === 'view') {
                document.querySelector('.password-tab[onclick="switchTab(\'view\')"]').classList.add('active');
                document.getElementById('viewTab').style.display = 'block';
            } else {
                document.querySelector('.password-tab[onclick="switchTab(\'edit\')"]').classList.add('active');
                document.getElementById('editTab').style.display = 'block';
                document.getElementById('passwordInput').focus();
            }
        }

        // –í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function enterViewMode() {
            currentMode = 'view';
            showMainContent();
        }

        // –í–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function enterEditMode() {
            const passwordInput = document.getElementById('passwordInput');
            const passwordError = document.getElementById('passwordError');
            const enteredPassword = passwordInput.value.trim();

            if (enteredPassword === EDIT_PASSWORD) {
                passwordError.style.display = 'none';
                passwordInput.value = '';
                currentMode = 'edit';
                localStorage.setItem(STORAGE_KEYS.EDIT_SESSION, 'active');
                showMainContent();
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
                if (navigator.vibrate) navigator.vibrate(200);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
        function showMainContent() {
            document.getElementById('passwordOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';

            localStorage.setItem(STORAGE_KEYS.MODE, currentMode);
            setupInterfaceForMode();
            initTable();
        }

        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–µ–∂–∏–º–∞
        function setupInterfaceForMode() {
            const viewMessage = document.getElementById('viewMessage');
            const resetButton = document.getElementById('resetButton');
            const testButton = document.getElementById('testButton');
            const editModeButton = document.getElementById('editModeButton');
            const modeStatus = document.getElementById('modeStatus');
            const modeText = document.getElementById('modeText');
            const lockIndicator = document.getElementById('lockIndicator');

            if (currentMode === 'view') {
                viewMessage.style.display = 'block';
                resetButton.disabled = true;
                testButton.disabled = true;
                editModeButton.style.display = 'inline-block';
                modeStatus.className = 'mode-status view';
                modeText.textContent = '–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞';
                lockIndicator.className = 'lock-indicator locked';
                disableInputFields();
            } else {
                viewMessage.style.display = 'none';
                resetButton.disabled = false;
                testButton.disabled = false;
                editModeButton.style.display = 'none';
                modeStatus.className = 'mode-status edit';
                modeText.textContent = '–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
                lockIndicator.className = 'lock-indicator unlocked';
                enableInputFields();
            }
        }

        // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
        function disableInputFields() {
            const inputs = document.querySelectorAll('.input-cell input');
            inputs.forEach(input => {
                input.disabled = true;
                input.title = '–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.';
            });
        }

        // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è –≤–≤–æ–¥–∞
        function enableInputFields() {
            const inputs = document.querySelectorAll('.input-cell input');
            inputs.forEach(input => {
                input.disabled = false;
                input.title = '';
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function switchToEditMode() {
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('passwordOverlay').style.display = 'flex';
            switchTab('edit');
            document.getElementById('passwordInput').focus();
        }

        // –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.removeItem(STORAGE_KEYS.EDIT_SESSION);
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('passwordOverlay').style.display = 'flex';
                switchTab('view');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
        function checkSavedSession() {
            const editSession = localStorage.getItem(STORAGE_KEYS.EDIT_SESSION);
            const savedMode = localStorage.getItem(STORAGE_KEYS.MODE);

            if (editSession === 'active') {
                currentMode = 'edit';
                return true;
            } else if (savedMode === 'view' || savedMode === 'edit') {
                currentMode = savedMode;
                if (currentMode === 'edit') {
                    currentMode = 'view';
                }
                return true;
            }
            return false;
        }

        // –ê–≤—Ç–æ–≤—ã—Ö–æ–¥ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ 4 —á–∞—Å–∞
        setTimeout(() => {
            if (localStorage.getItem(STORAGE_KEYS.EDIT_SESSION) === 'active') {
                localStorage.removeItem(STORAGE_KEYS.EDIT_SESSION);
                localStorage.setItem(STORAGE_KEYS.MODE, 'view');

                if (currentMode === 'edit') {
                    currentMode = 'view';
                    setupInterfaceForMode();
                    showWarning('–°–µ—Å—Å–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∏—Å—Ç–µ–∫–ª–∞. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω –≤ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.');
                }
            }
        }, 4 * 60 * 60 * 1000);

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    enterEditMode();
                }
            });

            if (checkSavedSession()) {
                showMainContent();
            } else {
                document.getElementById('passwordOverlay').style.display = 'flex';
                switchTab('view');
            }

            initProtection();
        });

        // ========== –ó–ê–©–ò–¢–ê –û–¢ –ò–ó–ú–ï–ù–ï–ù–ò–ô ==========

        function initProtection() {
            document.addEventListener('contextmenu', function(e) {
                if (currentMode === 'view') {
                    e.preventDefault();
                    showWarning('–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–π–¥–∏—Ç–µ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
                }
                return false;
            });

            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 123 ||
                    (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) ||
                    (e.ctrlKey && e.keyCode === 85)) {
                    e.preventDefault();
                    showWarning('–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω—ã!');
                    return false;
                }
            });

            console.log('%c ‚ö†Ô∏è –¢–£–†–ù–ò–†–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê "–í–ò–•–†–¨" ‚ö†Ô∏è ', 'color: #2c3e50; font-size: 24px; font-weight: bold;');
            console.log('%c –î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è –≤–≤–æ–¥–∞. ', 'color: white; background: #3498db; font-size: 16px;');
        }

        function showWarning(message) {
            const warning = document.getElementById('warningMessage');
            warning.textContent = message;
            warning.style.display = 'block';

            setTimeout(() => {
                warning.style.animation = 'fadeOut 0.3s';
                setTimeout(() => {
                    warning.style.display = 'none';
                    warning.style.animation = '';
                }, 300);
            }, 3000);
        }

        // ========== –î–ê–ù–ù–´–ï –ò –õ–û–ì–ò–ö–ê –¢–ê–ë–õ–ò–¶–´ ==========

        const participants = [
            { team: "–ò–Ω—Ç–µ–Ω—Å–∏–≤", name: "–ö—Å–µ–Ω–∏—è –õ.", id: 1, teamIndex: 0 },
            { team: "–ò–Ω—Ç–µ–Ω—Å–∏–≤", name: "–°–≤—è—Ç–æ—Å–ª–∞–≤ –ï.", id: 2, teamIndex: 0 },
            { team: "–ü—Ä–æ—Ä—ã–≤", name: "–ù–∏–∫–∏—Ç–∞ –£.", id: 3, teamIndex: 1 },
            { team: "–ü—Ä–æ—Ä—ã–≤", name: "–í–∞—Ä—è –ê.", id: 4, teamIndex: 1 },
            { team: "–ê–ª—å—Ñ–∞", name: "–î–º–∏—Ç—Ä–∏–π –í.", id: 5, teamIndex: 2 },
            { team: "–ê–ª—å—Ñ–∞", name: "–ò–≤–∞–Ω –§.", id: 6, teamIndex: 2 },
            { team: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", name: "–°–∞–≤–µ–ª–∏–π –°.", id: 7, teamIndex: 3 },
            { team: "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å", name: "–ë–æ–≥–¥–∞–Ω –ï.", id: 8, teamIndex: 3 },
            { team: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è", name: "–ê—Ä—Ç–µ–º –ü.", id: 9, teamIndex: 4 },
            { team: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è", name: "–î–∞–Ω–∏–ª–∞ –õ.", id: 10, teamIndex: 4 }
        ];

        function initTable() {
            createTable();
            loadFromLocalStorage();
            protectElements();

            if (currentMode === 'view') {
                disableInputFields();
            } else {
                enableInputFields();
            }
        }

        function createTable() {
            const table = document.getElementById('tournamentTable');

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ 3-–π (–ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
            while (table.rows.length > 3) {
                table.deleteRow(3);
            }

            participants.forEach((participant, index) => {
                const row = table.insertRow();
                const isFirstInTeam = index === 0 || participants[index-1].team !== participant.team;

                if (isFirstInTeam) {
                    row.className = 'team-header';
                } else {
                    row.className = 'participant-row';
                }

                if (isFirstInTeam) {
                    row.innerHTML = `
                        <td rowspan="2" class="team-name">"${participant.team}"</td>
                        <td class="participant-name">${participant.name}</td>
                        <td class="input-cell"><input type="number" id="angle_${index}" min="0" max="90" value="0" step="1" placeholder="0-90¬∞"></td>
                        <td class="input-cell"><input type="text" id="time_lz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_lz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="text" id="time_kz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_kz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="number" id="laps_${index}" min="0" value="0" placeholder="0+"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_gates_${index}" min="0" value="0" placeholder="0" title="–í—Ä–µ–∑–∞–Ω–∏–µ –≤ –≤–æ—Ä–æ—Ç–∞ (-5 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_fall_${index}" min="0" value="0" placeholder="0" title="–ü–∞–¥–µ–Ω–∏–µ (-10 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_flip_${index}" min="0" value="0" placeholder="0" title="–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç (-20 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="calculated-cell" id="total_penalty_${index}">0</td>
                        <td class="result-cell" id="score_track_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="personal-score" id="personal_score_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td rowspan="2" class="team-score" id="team_score_${participant.teamIndex}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td class="participant-name">${participant.name}</td>
                        <td class="input-cell"><input type="number" id="angle_${index}" min="0" max="90" value="0" step="1" placeholder="0-90¬∞"></td>
                        <td class="input-cell"><input type="text" id="time_lz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_lz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="text" id="time_kz_${index}" class="time-input" placeholder="–ú–ú:–°–°:–ú–°" value="00:00:00"></td>
                        <td class="result-cell" id="score_kz_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="input-cell"><input type="number" id="laps_${index}" min="0" value="0" placeholder="0+"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_gates_${index}" min="0" value="0" placeholder="0" title="–í—Ä–µ–∑–∞–Ω–∏–µ –≤ –≤–æ—Ä–æ—Ç–∞ (-5 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_fall_${index}" min="0" value="0" placeholder="0" title="–ü–∞–¥–µ–Ω–∏–µ (-10 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="input-cell penalty-cell-small"><input type="number" id="penalty_flip_${index}" min="0" value="0" placeholder="0" title="–ü–µ—Ä–µ–≤–æ—Ä–æ—Ç (-20 –∑–∞ –∫–∞–∂–¥–æ–µ)"></td>
                        <td class="calculated-cell" id="total_penalty_${index}">0</td>
                        <td class="result-cell" id="score_track_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                        <td class="personal-score" id="personal_score_${index}">–û–ñ–ò–î–ê–ù–ò–ï</td>
                    `;
                }
            });

            addInputEventListeners();
        }

        function addInputEventListeners() {
            for (let i = 0; i < participants.length; i++) {
                const inputs = [
                    `angle_${i}`, `time_lz_${i}`, `time_kz_${i}`, `laps_${i}`,
                    `penalty_gates_${i}`, `penalty_fall_${i}`, `penalty_flip_${i}`
                ];

                inputs.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', () => {
                            if (currentMode === 'edit') {
                                calculateAll();
                                saveToLocalStorage();
                            }
                        });

                        if (id.startsWith('time_')) {
                            input.addEventListener('blur', function() {
                                if (currentMode === 'edit') {
                                    formatTimeInput(this);
                                }
                            });
                        }
                    }
                });
            }
        }

        function protectElements() {
            const elements = document.querySelectorAll(
                '.result-cell, .personal-score, .team-score, .calculated-cell, .max-min-cell, .header-name'
            );
            elements.forEach(el => {
                el.classList.add('protected');
            });
        }

        function formatTimeInput(input) {
            let value = input.value.trim();
            if (!value) {
                input.value = '00:00:00';
                return;
            }

            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã
            value = value.replace(/[^\d]/g, '');

            // –ï—Å–ª–∏ –ø—É—Å—Ç–æ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –Ω—É–ª–∏
            if (value === '' || parseInt(value) === 0) {
                input.value = '00:00:00';
                return;
            }

            // –î–æ–ø–æ–ª–Ω—è–µ–º –¥–æ 6 —Ü–∏—Ñ—Ä
            while (value.length < 6) {
                value = '0' + value;
            }

            // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 6 —Ü–∏—Ñ—Ä
            value = value.substring(0, 6);

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ –ú–ú:–°–°:–ú–°
            const minutes = value.substring(0, 2);
            const seconds = value.substring(2, 4);
            const milliseconds = value.substring(4, 6);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
            const minsNum = parseInt(minutes);
            const secsNum = parseInt(seconds);
            const msNum = parseInt(milliseconds);

            if (secsNum >= 60) {
                alert('–°–µ–∫—É–Ω–¥—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 59!');
                input.value = '00:00:00';
                input.focus();
                return;
            }

            if (msNum >= 100) {
                alert('–ú–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ 99!');
                input.value = '00:00:00';
                input.focus();
                return;
            }

            input.value = `${minutes}:${seconds}:${milliseconds}`;
        }

        function timeToSeconds(timeStr) {
            if (!timeStr || timeStr === '00:00:00') return 0;

            const parts = timeStr.split(':');
            if (parts.length !== 3) return 0;

            const minutes = parseInt(parts[0]) || 0;
            const seconds = parseInt(parts[1]) || 0;
            const milliseconds = parseInt(parts[2]) || 0;

            if (isNaN(minutes) || isNaN(seconds) || isNaN(milliseconds)) return 0;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
            if (seconds >= 60 || milliseconds >= 100) return 0;

            return minutes * 60 + seconds + (milliseconds / 100);
        }

        function secondsToTime(seconds) {
            if (seconds <= 0) return '00:00:00';

            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            const ms = Math.round((seconds - Math.floor(seconds)) * 100);

            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}:${ms.toString().padStart(2, '0')}`;
        }

        function calculateAll() {
            const participantsData = [];

            for (let i = 0; i < participants.length; i++) {
                const gates = parseInt(document.getElementById(`penalty_gates_${i}`).value) || 0;
                const falls = parseInt(document.getElementById(`penalty_fall_${i}`).value) || 0;
                const flips = parseInt(document.getElementById(`penalty_flip_${i}`).value) || 0;
                const totalPenalty = (gates * 5) + (falls * 10) + (flips * 20);

                participantsData.push({
                    index: i,
                    angle: parseFloat(document.getElementById(`angle_${i}`).value) || 0,
                    timeLz: timeToSeconds(document.getElementById(`time_lz_${i}`).value),
                    timeKz: timeToSeconds(document.getElementById(`time_kz_${i}`).value),
                    laps: parseFloat(document.getElementById(`laps_${i}`).value) || 0,
                    gates: gates,
                    falls: falls,
                    flips: flips,
                    totalPenalty: totalPenalty,
                    teamIndex: participants[i].teamIndex
                });
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º—ã –∏ –º–∏–Ω–∏–º—É–º—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
            const validAngles = participantsData.filter(p => p.angle > 0).map(p => p.angle);
            const validTimeLz = participantsData.filter(p => p.timeLz > 0).map(p => p.timeLz);
            const validTimeKz = participantsData.filter(p => p.timeKz > 0).map(p => p.timeKz);
            const validLaps = participantsData.filter(p => p.laps > 0).map(p => p.laps);
            const validPenalties = participantsData.filter(p => p.totalPenalty > 0).map(p => p.totalPenalty);

            const maxAngle = validAngles.length > 0 ? Math.max(...validAngles) : 0;
            const minTimeLz = validTimeLz.length > 0 ? Math.min(...validTimeLz) : 0;
            const minTimeKz = validTimeKz.length > 0 ? Math.min(...validTimeKz) : 0;
            const maxLaps = validLaps.length > 0 ? Math.max(...validLaps) : 0;
            const minTotalPenalty = validPenalties.length > 0 ? Math.min(...validPenalties) : 0;

            document.getElementById('maxAngle').textContent = maxAngle;
            document.getElementById('minTimeLz').textContent = minTimeLz > 0 ? secondsToTime(minTimeLz) : '00:00:00';
            document.getElementById('minTimeKz').textContent = minTimeKz > 0 ? secondsToTime(minTimeKz) : '00:00:00';
            document.getElementById('maxLaps').textContent = maxLaps;
            document.getElementById('minPenalty').textContent = minTotalPenalty;

            let maxScoreLz = 0, maxScoreKz = 0, maxScoreTrack = 0;

            participantsData.forEach(data => {
                const i = data.index;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É–º–º—É —à—Ç—Ä–∞—Ñ–æ–≤
                document.getElementById(`total_penalty_${i}`).textContent = data.totalPenalty;

                // –†–∞—Å—á–µ—Ç –±–∞–ª–ª–æ–≤ –õ–∏—Ç–æ—Ñ—Ñ
                let scoreLz = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (maxAngle > 0 && data.angle > 0 && minTimeLz > 0 && data.timeLz > 0) {
                    const calculated = ((data.angle / maxAngle) * 70) + ((minTimeLz / data.timeLz) * 30);
                    scoreLz = calculated.toFixed(2);
                    maxScoreLz = Math.max(maxScoreLz, calculated);
                }

                // –†–∞—Å—á–µ—Ç –±–∞–ª–ª–æ–≤ –ö–≤–∞–¥—Ä–æ—Å–∏–º
                let scoreKz = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (minTimeKz > 0 && data.timeKz > 0) {
                    const calculated = (minTimeKz * 100) / data.timeKz;
                    scoreKz = calculated.toFixed(2);
                    maxScoreKz = Math.max(maxScoreKz, calculated);
                }

                // –†–∞—Å—á–µ—Ç –±–∞–ª–ª–æ–≤ –¢—Ä–∞—Å—Å—ã
                let scoreTrack = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (maxLaps > 0 && data.laps > 0) {
                    const calculated = ((data.laps / maxLaps) * 100) - data.totalPenalty;
                    scoreTrack = calculated > 0 ? calculated.toFixed(2) : "0.00";
                    maxScoreTrack = Math.max(maxScoreTrack, calculated > 0 ? calculated : 0);
                }

                // –õ–∏—á–Ω—ã–π –∑–∞—á–µ—Ç
                let personalScore = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (scoreLz !== "–û–ñ–ò–î–ê–ù–ò–ï" && scoreKz !== "–û–ñ–ò–î–ê–ù–ò–ï" && scoreTrack !== "–û–ñ–ò–î–ê–ù–ò–ï") {
                    personalScore = (parseFloat(scoreLz) + parseFloat(scoreKz) + parseFloat(scoreTrack)).toFixed(2);
                }

                data.personalScore = personalScore === "–û–ñ–ò–î–ê–ù–ò–ï" ? 0 : parseFloat(personalScore);

                // –û–±–Ω–æ–≤–ª—è–µ–º —è—á–µ–π–∫–∏
                document.getElementById(`score_lz_${i}`).textContent = scoreLz;
                document.getElementById(`score_lz_${i}`).className = scoreLz === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";

                document.getElementById(`score_kz_${i}`).textContent = scoreKz;
                document.getElementById(`score_kz_${i}`).className = scoreKz === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";

                document.getElementById(`score_track_${i}`).textContent = scoreTrack;
                document.getElementById(`score_track_${i}`).className = scoreTrack === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "result-cell";

                document.getElementById(`personal_score_${i}`).textContent = personalScore;
                document.getElementById(`personal_score_${i}`).className = personalScore === "–û–ñ–ò–î–ê–ù–ò–ï" ? "error-cell" : "personal-score";
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–∫—Å–∏–º—É–º—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
            document.getElementById('maxScoreLz').textContent = maxScoreLz.toFixed(2);
            document.getElementById('maxScoreKz').textContent = maxScoreKz.toFixed(2);
            document.getElementById('maxScoreTrack').textContent = maxScoreTrack.toFixed(2);

            // –†–∞—Å—á–µ—Ç –∫–æ–º–∞–Ω–¥–Ω—ã—Ö –±–∞–ª–ª–æ–≤
            const teamScores = {};
            participantsData.forEach(data => {
                if (!teamScores[data.teamIndex]) teamScores[data.teamIndex] = 0;
                teamScores[data.teamIndex] += data.personalScore;
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥–Ω—ã–µ –±–∞–ª–ª—ã
            for (const [teamIndex, teamScore] of Object.entries(teamScores)) {
                document.getElementById(`team_score_${teamIndex}`).textContent = teamScore.toFixed(2);
                document.getElementById(`team_score_${teamIndex}`).className = "team-score";
            }

            // –î–ª—è –∫–æ–º–∞–Ω–¥ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –û–ñ–ò–î–ê–ù–ò–ï
            for (let i = 0; i < 5; i++) {
                if (!teamScores[i]) {
                    document.getElementById(`team_score_${i}`).textContent = "–û–ñ–ò–î–ê–ù–ò–ï";
                    document.getElementById(`team_score_${i}`).className = "error-cell";
                }
            }
        }

        function saveToLocalStorage() {
            const data = {};
            for (let i = 0; i < participants.length; i++) {
                data[`participant_${i}`] = {
                    angle: document.getElementById(`angle_${i}`).value,
                    timeLz: document.getElementById(`time_lz_${i}`).value,
                    timeKz: document.getElementById(`time_kz_${i}`).value,
                    laps: document.getElementById(`laps_${i}`).value,
                    penalty_gates: document.getElementById(`penalty_gates_${i}`).value,
                    penalty_fall: document.getElementById(`penalty_fall_${i}`).value,
                    penalty_flip: document.getElementById(`penalty_flip_${i}`).value
                };
            }
            localStorage.setItem(STORAGE_KEYS.DATA, JSON.stringify(data));
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem(STORAGE_KEYS.DATA);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    for (let i = 0; i < participants.length; i++) {
                        if (data[`participant_${i}`]) {
                            const p = data[`participant_${i}`];
                            document.getElementById(`angle_${i}`).value = p.angle || 0;
                            document.getElementById(`time_lz_${i}`).value = p.timeLz || '00:00:00';
                            document.getElementById(`time_kz_${i}`).value = p.timeKz || '00:00:00';
                            document.getElementById(`laps_${i}`).value = p.laps || 0;
                            document.getElementById(`penalty_gates_${i}`).value = p.penalty_gates || 0;
                            document.getElementById(`penalty_fall_${i}`).value = p.penalty_fall || 0;
                            document.getElementById(`penalty_flip_${i}`).value = p.penalty_flip || 0;
                        }
                    }
                    calculateAll();
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', e);
                }
            }
        }

        function resetAll() {
            if (currentMode !== 'edit') {
                showWarning('–¢–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.');
                return;
            }

            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –í—Å–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                for (let i = 0; i < participants.length; i++) {
                    document.getElementById(`angle_${i}`).value = 0;
                    document.getElementById(`time_lz_${i}`).value = '00:00:00';
                    document.getElementById(`time_kz_${i}`).value = '00:00:00';
                    document.getElementById(`laps_${i}`).value = 0;
                    document.getElementById(`penalty_gates_${i}`).value = 0;
                    document.getElementById(`penalty_fall_${i}`).value = 0;
                    document.getElementById(`penalty_flip_${i}`).value = 0;

                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞—Å—á–µ—Ç–Ω—ã–µ —è—á–µ–π–∫–∏
                    document.getElementById(`score_lz_${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                    document.getElementById(`score_lz_${i}`).className = 'error-cell';

                    document.getElementById(`score_kz_${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                    document.getElementById(`score_kz_${i}`).className = 'error-cell';

                    document.getElementById(`score_track_${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                    document.getElementById(`score_track_${i}`).className = 'error-cell';

                    document.getElementById(`personal_score_${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                    document.getElementById(`personal_score_${i}`).className = 'error-cell';

                    document.getElementById(`total_penalty_${i}`).textContent = '0';
                }

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥–Ω—ã–µ –±–∞–ª–ª—ã
                for (let i = 0; i < 5; i++) {
                    document.getElementById(`team_score_${i}`).textContent = '–û–ñ–ò–î–ê–ù–ò–ï';
                    document.getElementById(`team_score_${i}`).className = 'error-cell';
                }

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
                document.getElementById('maxAngle').textContent = '0';
                document.getElementById('minTimeLz').textContent = '00:00:00';
                document.getElementById('maxScoreLz').textContent = '0.00';
                document.getElementById('minTimeKz').textContent = '00:00:00';
                document.getElementById('maxScoreKz').textContent = '0.00';
                document.getElementById('maxLaps').textContent = '0';
                document.getElementById('minPenalty').textContent = '0';
                document.getElementById('maxScoreTrack').textContent = '0.00';

                localStorage.removeItem(STORAGE_KEYS.DATA);
                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã!');
            }
        }

        function fillTestData() {
            if (currentMode !== 'edit') {
                showWarning('–¢–æ–ª—å–∫–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.');
                return;
            }

            const testData = [
                { angle: 51, timeLz: '00:45:00', timeKz: '01:15:30', laps: 8, gates: 1, falls: 0, flips: 0 },
                { angle: 63, timeLz: '00:53:00', timeKz: '01:20:45', laps: 10, gates: 2, falls: 1, flips: 0 },
                { angle: 45, timeLz: '00:48:30', timeKz: '01:30:45', laps: 12, gates: 0, falls: 1, flips: 0 },
                { angle: 38, timeLz: '00:52:15', timeKz: '01:35:20', laps: 9, gates: 1, falls: 0, flips: 1 },
                { angle: 55, timeLz: '00:42:10', timeKz: '01:25:30', laps: 11, gates: 3, falls: 0, flips: 0 },
                { angle: 42, timeLz: '00:55:40', timeKz: '01:40:15', laps: 7, gates: 0, falls: 2, flips: 0 },
                { angle: 60, timeLz: '00:46:20', timeKz: '01:18:50', laps: 13, gates: 1, falls: 1, flips: 0 },
                { angle: 35, timeLz: '00:57:10', timeKz: '01:45:30', laps: 6, gates: 2, falls: 0, flips: 1 },
                { angle: 48, timeLz: '00:49:45', timeKz: '01:28:15', laps: 10, gates: 0, falls: 0, flips: 0 },
                { angle: 40, timeLz: '00:54:20', timeKz: '01:38:40', laps: 8, gates: 1, falls: 1, flips: 0 }
            ];

            for (let i = 0; i < participants.length; i++) {
                const data = testData[i];
                document.getElementById(`angle_${i}`).value = data.angle;
                document.getElementById(`time_lz_${i}`).value = data.timeLz;
                document.getElementById(`time_kz_${i}`).value = data.timeKz;
                document.getElementById(`laps_${i}`).value = data.laps;
                document.getElementById(`penalty_gates_${i}`).value = data.gates;
                document.getElementById(`penalty_fall_${i}`).value = data.falls;
                document.getElementById(`penalty_flip_${i}`).value = data.flips;
            }

            calculateAll();
            saveToLocalStorage();
            alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        function exportToExcel() {
            let csvContent = "data:text/csv;charset=utf-8,";
            const headers = [
                "–ö–æ–º–∞–Ω–¥–∞", "–£—á–∞—Å—Ç–Ω–∏–∫", "–£–≥–æ–ª (–õ–∏—Ç–æ—Ñ—Ñ)", "–í—Ä–µ–º—è –õ–ó", "–ë–∞–ª–ª—ã –õ–ó",
                "–í—Ä–µ–º—è –ö–ó", "–ë–∞–ª–ª—ã –ö–ó", "–ö—Ä—É–≥–∏", "–®—Ç—Ä–∞—Ñ—ã: –í–æ—Ä–æ—Ç–∞", "–®—Ç—Ä–∞—Ñ—ã: –ü–∞–¥–µ–Ω–∏–µ", "–®—Ç—Ä–∞—Ñ—ã: –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç",
                "–°—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤", "–ë–∞–ª–ª—ã –¢—Ä–∞—Å—Å—ã", "–ë–∞–ª–ª—ã –õ–ó", "–ë–∞–ª–ª—ã –ö–ó"
            ];

            csvContent += headers.join(";") + "\n";

            for (let i = 0; i < participants.length; i++) {
                const participant = participants[i];
                const isFirstInTeam = i === 0 || participants[i-1].team !== participant.team;

                let teamScore = "–û–ñ–ò–î–ê–ù–ò–ï";
                if (isFirstInTeam) {
                    teamScore = document.getElementById(`team_score_${participant.teamIndex}`).textContent;
                }

                const row = [
                    isFirstInTeam ? `"${participant.team}"` : "",
                    participant.name,
                    document.getElementById(`angle_${i}`).value,
                    document.getElementById(`time_lz_${i}`).value,
                    document.getElementById(`score_lz_${i}`).textContent,
                    document.getElementById(`time_kz_${i}`).value,
                    document.getElementById(`score_kz_${i}`).textContent,
                    document.getElementById(`laps_${i}`).value,
                    document.getElementById(`penalty_gates_${i}`).value,
                    document.getElementById(`penalty_fall_${i}`).value,
                    document.getElementById(`penalty_flip_${i}`).value,
                    document.getElementById(`total_penalty_${i}`).textContent,
                    document.getElementById(`score_track_${i}`).textContent,
                    document.getElementById(`personal_score_${i}`).textContent,
                    isFirstInTeam ? teamScore : ""
                ];

                csvContent += row.join(";") + "\n";
            }

            csvContent += "\n;;;–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞;;;;;;;;;;;;\n";
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É–≥–æ–ª;${document.getElementById('maxAngle').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –õ–ó;${document.getElementById('minTimeLz').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –õ–ó;${document.getElementById('maxScoreLz').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ö–ó;${document.getElementById('minTimeKz').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã –ö–ó;${document.getElementById('maxScoreKz').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∫—Ä—É–≥–∏;${document.getElementById('maxLaps').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤;${document.getElementById('minPenalty').textContent};;;;;;;;;;;\n`;
            csvContent += `–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã —Ç—Ä–∞—Å—Å—ã;${document.getElementById('maxScoreTrack').textContent};;;;;;;;;;;`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            const date = new Date().toISOString().slice(0,10).replace(/-/g, '');
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `—Ç—É—Ä–Ω–∏—Ä_–≤–∏—Ö—Ä—å_${date}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert('–¢–∞–±–ª–∏—Ü–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ CSV —Ñ–∞–π–ª!');
        }

        setInterval(() => {
            if (currentMode === 'view') {
                calculateAll();
            }
        }, 60000);
    </script>
    <!-- –ü–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ -->
<script src="online.js"></script>
</body>
</html>
