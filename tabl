<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Турнирная таблица клуба "Вихрь"</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            overflow-x: auto;
        }
        .tournament-table {
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            font-size: 0.85em;
            min-width: 1400px;
        }
        .tournament-table th, .tournament-table td {
            border: 1px solid #ddd;
            padding: 5px 8px;
            text-align: center;
            vertical-align: middle;
            min-width: 70px;
        }
        .tournament-table th {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
        }
        .header-row {
            background-color: #34495e;
            color: white;
        }
        .title-row {
            background-color: #1a252f;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
        }
        .input-cell {
            background-color: #fff;
        }
        .input-cell input {
            width: 90%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
            font-size: 0.9em;
        }
        .result-cell {
            background-color: #e8f4fd;
            font-weight: bold;
            color: #2c3e50;
        }
        .calculated-cell {
            background-color: #f0f8ff;
            font-weight: bold;
            color: #2c5523;
        }
        .team-header {
            background-color: #ecf0f1;
            font-weight: bold;
        }
        .participant-row {
            background-color: #f8f9fa;
        }
        .sub-header {
            background-color: #bdc3c7;
            font-weight: bold;
            font-size: 0.9em;
        }
        .max-min-row {
            background-color: #d5dbdb;
            font-style: italic;
            font-size: 0.8em;
        }
        .controls {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .controls button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 0.9em;
        }
        .controls button:hover {
            background-color: #2980b9;
        }
        .instructions {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            margin-top: 0;
            color: #856404;
        }
        .notes {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 10px;
            padding: 10px;
            background-color: #ecf0f1;
            border-left: 4px solid #3498db;
        }
        .time-input {
            font-family: monospace;
        }
        .category-header {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ТАБЛИЦА БОЛЬШОГО ЗИМНЕГО ТУРНИРА КЛУБА ПИЛОТОВ БПЛА "ВИХРЬ"</h1>
        
        <div class="instructions">
            <h3>Инструкция по использованию:</h3>
            <ul>
                <li>Вводите данные в белые ячейки с полями ввода</li>
                <li>Для времени используйте формат: ММ:СС (например: 01:30)</li>
                <li>Нажмите "Рассчитать все результаты" для выполнения расчетов</li>
                <li>Нажмите "Сбросить все данные" для очистки таблицы</li>
            </ul>
        </div>
        
        <div class="controls">
            <button onclick="calculateAll()">Рассчитать все результаты</button>
            <button onclick="resetAll()">Сбросить все данные</button>
            <button onclick="fillTestData()">Заполнить тестовые данные</button>
            <button onclick="exportToExcel()">Экспорт в Excel</button>
        </div>
        
        <table class="tournament-table" id="tournamentTable">
            <!-- Заголовок -->
            <tr class="title-row">
                <td colspan="15">ТАБЛИЦА БОЛЬШОГО ЗИМНЕГО ТУРНИРА КЛУБА ПИЛОТОВ БПЛА "ВИХРЬ"</td>
            </tr>
            
            <!-- Основные заголовки -->
            <tr class="header-row">
                <th rowspan="3">№ п/п</th>
                <th rowspan="3">Команда</th>
                <th rowspan="3">Участник</th>
                <th colspan="4">ЛИТОФФ</th>
                <th colspan="2">КВАДРОСИМ</th>
                <th colspan="3">ТРАССА</th>
                <th rowspan="3">Общие баллы ЛЗ</th>
                <th rowspan="3">Общие баллы КЗ</th>
                <th rowspan="3">Общие баллы команды</th>
            </tr>
            
            <tr class="sub-header">
                <th colspan="2">Угол</th>
                <th colspan="2">Время (ММ:СС)</th>
                <th colspan="2">Время (ММ:СС)</th>
                <th rowspan="2">Кол-во кругов</th>
                <th rowspan="2">Штраф</th>
                <th rowspan="2">Баллы</th>
            </tr>
            
            <tr class="max-min-row">
                <!-- Литофф -->
                <td>Угол<br><small>ввод данных</small></td>
                <td>Время ЛЗ<br><small>ввод данных</small></td>
                <td>Баллы ЛЗ<br><small>авто расчет</small></td>
                <td>Макс. баллы ЛЗ<br><small>авто расчет</small></td>
                
                <!-- Квадросим -->
                <td>Время КЗ<br><small>ввод данных</small></td>
                <td>Баллы КЗ<br><small>авто расчет</small></td>
                
                <!-- Трасса -->
                <td>Круги<br><small>ввод данных</small></td>
                <td>Штраф<br><small>ввод данных</small></td>
                <td>Баллы трассы<br><small>авто расчет</small></td>
                
                <!-- Пустые для выравнивания -->
                <td></td>
                <td></td>
                <td></td>
            </tr>
            
            <!-- Данные участников будут заполняться JavaScript -->
        </table>
        
        <div class="notes">
            <p><strong>Формулы расчетов (как в Excel):</strong></p>
            <ul>
                <li><strong>Баллы ЛЗ</strong> = (Угол/Макс.Угол * 70) + (Мин.Время_ЛЗ/Время_ЛЗ * 30)</li>
                <li><strong>Баллы КЗ</strong> = (Мин.Время_КЗ * 100) / Время_КЗ</li>
                <li><strong>Баллы трассы</strong> = (Круги/Макс.Круги * 100) - Штраф</li>
                <li><strong>Общие баллы ЛЗ</strong> = Баллы ЛЗ участника 1 + Баллы ЛЗ участника 2</li>
                <li><strong>Общие баллы КЗ</strong> = Баллы КЗ участника 1 + Баллы КЗ участника 2</li>
                <li><strong>Общие баллы команды</strong> = Общие баллы ЛЗ + Общие баллы КЗ + Баллы трассы</li>
            </ul>
        </div>
    </div>

    <script>
        // Данные участников
        const participants = [
            { team: "Интенсив", name: "Ксения Л.", id: 1, teamNumber: 1 },
            { team: "Интенсив", name: "Святослав Е.", id: 2, teamNumber: 1 },
            { team: "Прорыв", name: "Никита У.", id: 3, teamNumber: 2 },
            { team: "Прорыв", name: "Варя А.", id: 4, teamNumber: 2 },
            { team: "Альфа", name: "Дмитрий В.", id: 5, teamNumber: 3 },
            { team: "Альфа", name: "Иван Ф.", id: 6, teamNumber: 3 },
            { team: "Стабильность", name: "Савелий С.", id: 7, teamNumber: 4 },
            { team: "Стабильность", name: "Богдан Е.", id: 8, teamNumber: 4 },
            { team: "Мотивация", name: "Артем П.", id: 9, teamNumber: 5 },
            { team: "Мотивация", name: "Данила Л.", id: 10, teamNumber: 5 }
        ];

        // Создаем таблицу с участниками
        function createTable() {
            const table = document.getElementById('tournamentTable');
            
            // Удаляем существующие строки с данными (кроме заголовков)
            while (table.rows.length > 4) {
                table.deleteRow(4);
            }
            
            // Добавляем строки для каждого участника
            participants.forEach((participant, index) => {
                const row = table.insertRow();
                const isFirstInTeam = index === 0 || participants[index-1].team !== participant.team;
                
                if (isFirstInTeam) {
                    row.className = 'team-header';
                } else {
                    row.className = 'participant-row';
                }
                
                // Заполняем ячейки
                if (isFirstInTeam) {
                    row.innerHTML = `
                        <td>${participant.teamNumber}.</td>
                        <td rowspan="2">"${participant.team}"</td>
                        <td>${participant.id % 2 === 1 ? '1.' : '2.'}</td>
                        
                        <!-- Литофф -->
                        <td class="input-cell"><input type="number" id="angle_${index}" min="0" max="90" value="0" step="1"></td>
                        <td class="input-cell"><input type="text" id="time_lz_${index}" class="time-input" placeholder="ММ:СС" value="00:00"></td>
                        <td class="result-cell" id="score_lz_${index}">0.00</td>
                        <td class="calculated-cell" id="max_score_lz_${index}">0.00</td>
                        
                        <!-- Квадросим -->
                        <td class="input-cell"><input type="text" id="time_kz_${index}" class="time-input" placeholder="ММ:СС" value="00:00"></td>
                        <td class="result-cell" id="score_kz_${index}">0.00</td>
                        
                        <!-- Трасса -->
                        <td class="input-cell"><input type="number" id="laps_${index}" min="0" value="0"></td>
                        <td class="input-cell"><input type="number" id="penalty_${index}" min="0" value="0"></td>
                        <td class="result-cell" id="score_track_${index}">0.00</td>
                        
                        <!-- Общие баллы -->
                        <td class="calculated-cell" id="total_lz_${index}">0.00</td>
                        <td class="calculated-cell" id="total_kz_${index}">0.00</td>
                        <td class="calculated-cell" id="team_total_${index}">0.00</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td></td>
                        <td>${participant.id % 2 === 1 ? '1.' : '2.'}</td>
                        <td>${participant.name}</td>
                        
                        <!-- Литофф -->
                        <td class="input-cell"><input type="number" id="angle_${index}" min="0" max="90" value="0" step="1"></td>
                        <td class="input-cell"><input type="text" id="time_lz_${index}" class="time-input" placeholder="ММ:СС" value="00:00"></td>
                        <td class="result-cell" id="score_lz_${index}">0.00</td>
                        <td class="calculated-cell" id="max_score_lz_${index}">0.00</td>
                        
                        <!-- Квадросим -->
                        <td class="input-cell"><input type="text" id="time_kz_${index}" class="time-input" placeholder="ММ:СС" value="00:00"></td>
                        <td class="result-cell" id="score_kz_${index}">0.00</td>
                        
                        <!-- Трасса -->
                        <td class="input-cell"><input type="number" id="laps_${index}" min="0" value="0"></td>
                        <td class="input-cell"><input type="number" id="penalty_${index}" min="0" value="0"></td>
                        <td class="result-cell" id="score_track_${index}">0.00</td>
                        
                        <!-- Общие баллы -->
                        <td class="calculated-cell" id="total_lz_${index}">0.00</td>
                        <td class="calculated-cell" id="total_kz_${index}">0.00</td>
                        <td class="calculated-cell" id="team_total_${index}">0.00</td>
                    `;
                }
            });
            
            // Добавляем обработчики событий для автоматического расчета при вводе
            addInputEventListeners();
        }
        
        // Добавляем обработчики событий для полей ввода
        function addInputEventListeners() {
            for (let i = 0; i < participants.length; i++) {
                document.getElementById(`angle_${i}`).addEventListener('input', () => calculateAll());
                document.getElementById(`time_lz_${i}`).addEventListener('input', () => calculateAll());
                document.getElementById(`time_kz_${i}`).addEventListener('input', () => calculateAll());
                document.getElementById(`laps_${i}`).addEventListener('input', () => calculateAll());
                document.getElementById(`penalty_${i}`).addEventListener('input', () => calculateAll());
            }
        }
        
        // Преобразование времени из строки в секунды
        function timeToSeconds(timeStr) {
            if (!timeStr || timeStr === '00:00' || timeStr === '0:00') return 0;
            
            const parts = timeStr.split(':');
            if (parts.length !== 2) return 0;
            
            const minutes = parseInt(parts[0]) || 0;
            const seconds = parseInt(parts[1]) || 0;
            
            return minutes * 60 + seconds;
        }
        
        // Преобразование секунд в строку времени
        function secondsToTime(seconds) {
            if (seconds <= 0) return '00:00';
            
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Расчет всех результатов
        function calculateAll() {
            // Собираем все данные
            const data = [];
            
            for (let i = 0; i < participants.length; i++) {
                const angle = parseFloat(document.getElementById(`angle_${i}`).value) || 0;
                const timeLz = timeToSeconds(document.getElementById(`time_lz_${i}`).value);
                const timeKz = timeToSeconds(document.getElementById(`time_kz_${i}`).value);
                const laps = parseFloat(document.getElementById(`laps_${i}`).value) || 0;
                const penalty = parseFloat(document.getElementById(`penalty_${i}`).value) || 0;
                
                data.push({
                    angle,
                    timeLz,
                    timeKz,
                    laps,
                    penalty,
                    team: participants[i].team,
                    teamNumber: participants[i].teamNumber
                });
            }
            
            // Рассчитываем максимумы и минимумы
            const maxAngle = Math.max(...data.filter(d => d.angle > 0).map(d => d.angle));
            const minTimeLz = Math.min(...data.filter(d => d.timeLz > 0).map(d => d.timeLz));
            const minTimeKz = Math.min(...data.filter(d => d.timeKz > 0).map(d => d.timeKz));
            const maxLaps = Math.max(...data.filter(d => d.laps > 0).map(d => d.laps));
            
            // Рассчитываем баллы для каждого участника
            data.forEach((item, index) => {
                // Баллы ЛЗ
                let scoreLz = 0;
                if (maxAngle > 0 && item.angle > 0 && item.timeLz > 0 && minTimeLz > 0) {
                    scoreLz = ((item.angle / maxAngle) * 70) + ((minTimeLz / item.timeLz) * 30);
                }
                
                // Баллы КЗ
                let scoreKz = 0;
                if (item.timeKz > 0 && minTimeKz > 0) {
                    scoreKz = (minTimeKz * 100) / item.timeKz;
                }
                
                // Баллы трассы
                let scoreTrack = 0;
                if (maxLaps > 0 && item.laps > 0) {
                    scoreTrack = (item.laps / maxLaps) * 100 - item.penalty;
                    if (scoreTrack < 0) scoreTrack = 0;
                }
                
                // Обновляем ячейки
                document.getElementById(`score_lz_${index}`).textContent = scoreLz.toFixed(2);
                document.getElementById(`score_kz_${index}`).textContent = scoreKz.toFixed(2);
                document.getElementById(`score_track_${index}`).textContent = scoreTrack.toFixed(2);
                
                // Сохраняем расчеты в данные
                item.scoreLz = scoreLz;
                item.scoreKz = scoreKz;
                item.scoreTrack = scoreTrack;
            });
            
            // Рассчитываем максимальные баллы ЛЗ
            const maxScoreLz = Math.max(...data.filter(d => d.scoreLz > 0).map(d => d.scoreLz));
            
            // Обновляем максимальные баллы ЛЗ для каждого участника
            data.forEach((item, index) => {
                document.getElementById(`max_score_lz_${index}`).textContent = maxScoreLz.toFixed(2);
            });
            
            // Рассчитываем общие баллы по командам
            const teamTotals = {};
            
            data.forEach((item, index) => {
                if (!teamTotals[item.team]) {
                    teamTotals[item.team] = {
                        totalLz: 0,
                        totalKz: 0,
                        scoreTrack: 0,
                        member1: null,
                        member2: null
                    };
                }
                
                // Находим первого и второго участника команды
                if (!teamTotals[item.team].member1) {
                    teamTotals[item.team].member1 = index;
                } else if (!teamTotals[item.team].member2) {
                    teamTotals[item.team].member2 = index;
                }
                
                // Суммируем баллы
                teamTotals[item.team].totalLz += item.scoreLz;
                teamTotals[item.team].totalKz += item.scoreKz;
                teamTotals[item.team].scoreTrack = item.scoreTrack; // Баллы трассы только у одного участника
            });
            
            // Обновляем общие баллы для каждой команды
            Object.keys(teamTotals).forEach(team => {
                const totals = teamTotals[team];
                
                // Общие баллы ЛЗ (сумма двух участников)
                document.getElementById(`total_lz_${totals.member1}`).textContent = totals.totalLz.toFixed(2);
                document.getElementById(`total_lz_${totals.member2}`).textContent = totals.totalLz.toFixed(2);
                
                // Общие баллы КЗ (сумма двух участников)
                document.getElementById(`total_kz_${totals.member1}`).textContent = totals.totalKz.toFixed(2);
                document.getElementById(`total_kz_${totals.member2}`).textContent = totals.totalKz.toFixed(2);
                
                // Общие баллы команды
                const teamTotal = totals.totalLz + totals.totalKz + totals.scoreTrack;
                document.getElementById(`team_total_${totals.member1}`).textContent = teamTotal.toFixed(2);
                document.getElementById(`team_total_${totals.member2}`).textContent = teamTotal.toFixed(2);
            });
            
            // Обновляем заголовки с максимумами/минимумами
            updateHeaders(maxAngle, minTimeLz, minTimeKz, maxLaps, maxScoreLz);
        }
        
        // Обновление заголовков с максимумами/минимумами
        function updateHeaders(maxAngle, minTimeLz, minTimeKz, maxLaps, maxScoreLz) {
            // Здесь можно добавить обновление заголовков, если нужно
            console.log('Максимальный угол:', maxAngle);
            console.log('Минимальное время ЛЗ:', secondsToTime(minTimeLz));
            console.log('Минимальное время КЗ:', secondsToTime(minTimeKz));
            console.log('Максимальное количество кругов:', maxLaps);
            console.log('Максимальные баллы ЛЗ:', maxScoreLz);
        }
        
        // Сброс всех данных
        function resetAll() {
            if (confirm('Вы уверены, что хотите сбросить все данные?')) {
                for (let i = 0; i < participants.length; i++) {
                    document.getElementById(`angle_${i}`).value = 0;
                    document.getElementById(`time_lz_${i}`).value = '00:00';
                    document.getElementById(`time_kz_${i}`).value = '00:00';
                    document.getElementById(`laps_${i}`).value = 0;
                    document.getElementById(`penalty_${i}`).value = 0;
                    
                    document.getElementById(`score_lz_${i}`).textContent = '0.00';
                    document.getElementById(`score_kz_${i}`).textContent = '0.00';
                    document.getElementById(`score_track_${i}`).textContent = '0.00';
                    document.getElementById(`max_score_lz_${i}`).textContent = '0.00';
                    document.getElementById(`total_lz_${i}`).textContent = '0.00';
                    document.getElementById(`total_kz_${i}`).textContent = '0.00';
                    document.getElementById(`team_total_${i}`).textContent = '0.00';
                }
                
                updateHeaders(0, 0, 0, 0, 0);
                alert('Все данные сброшены!');
            }
        }
        
        // Заполнение тестовыми данными
        function fillTestData() {
            // Тестовые данные (согласно структуре Excel)
            const testData = [
                // Интенсив
                { angle: 45, timeLz: '00:45', timeKz: '01:30', laps: 10, penalty: 2 },
                { angle: 38, timeLz: '00:50', timeKz: '01:45', laps: 0, penalty: 0 },
                // Прорыв
                { angle: 42, timeLz: '00:48', timeKz: '01:25', laps: 12, penalty: 3 },
                { angle: 35, timeLz: '00:55', timeKz: '01:55', laps: 0, penalty: 0 },
                // Альфа
                { angle: 50, timeLz: '00:40', timeKz: '01:20', laps: 15, penalty: 4 },
                { angle: 30, timeLz: '01:00', timeKz: '02:00', laps: 0, penalty: 0 },
                // Стабильность
                { angle: 40, timeLz: '00:50', timeKz: '01:40', laps: 9, penalty: 1 },
                { angle: 33, timeLz: '00:58', timeKz: '01:50', laps: 0, penalty: 0 },
                // Мотивация
                { angle: 48, timeLz: '00:42', timeKz: '01:22', laps: 13, penalty: 2 },
                { angle: 36, timeLz: '00:53', timeKz: '01:48', laps: 0, penalty: 0 }
            ];
            
            for (let i = 0; i < participants.length; i++) {
                const data = testData[i];
                document.getElementById(`angle_${i}`).value = data.angle;
                document.getElementById(`time_lz_${i}`).value = data.timeLz;
                document.getElementById(`time_kz_${i}`).value = data.timeKz;
                document.getElementById(`laps_${i}`).value = data.laps;
                document.getElementById(`penalty_${i}`).value = data.penalty;
            }
            
            calculateAll();
            alert('Тестовые данные загружены и рассчитаны!');
        }
        
        // Экспорт в Excel
        function exportToExcel() {
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Заголовки
            const headers = [
                "№ п/п", "Команда", "Участник", 
                "Угол", "Время ЛЗ", "Баллы ЛЗ", "Макс. баллы ЛЗ",
                "Время КЗ", "Баллы КЗ",
                "Круги", "Штраф", "Баллы трассы",
                "Общие баллы ЛЗ", "Общие баллы КЗ", "Общие баллы команды"
            ];
            
            csvContent += headers.join(",") + "\n";
            
            // Данные
            for (let i = 0; i < participants.length; i++) {
                const participant = participants[i];
                const row = [
                    i === 0 || participants[i-1].team !== participant.team ? `${participant.teamNumber}.` : "",
                    i === 0 || participants[i-1].team !== participant.team ? `"${participant.team}"` : "",
                    participant.name,
                    document.getElementById(`angle_${i}`).value,
                    document.getElementById(`time_lz_${i}`).value,
                    document.getElementById(`score_lz_${i}`).textContent,
                    document.getElementById(`max_score_lz_${i}`).textContent,
                    document.getElementById(`time_kz_${i}`).value,
                    document.getElementById(`score_kz_${i}`).textContent,
                    document.getElementById(`laps_${i}`).value,
                    document.getElementById(`penalty_${i}`).value,
                    document.getElementById(`score_track_${i}`).textContent,
                    document.getElementById(`total_lz_${i}`).textContent,
                    document.getElementById(`total_kz_${i}`).textContent,
                    document.getElementById(`team_total_${i}`).textContent
                ];
                
                csvContent += row.join(",") + "\n";
            }
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "турнирная_таблица.csv");
            document.body.appendChild(link);
            
            link.click();
            document.body.removeChild(link);
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            createTable();
            calculateAll(); // Рассчитать начальные значения
        });
    </script>
</body>
</html>
